<?xml version="1.0" encoding="UTF-8"?>
<!--
*************************************************
	         AnyLogic Project File 
*************************************************	         
-->
<AnyLogicWorkspace WorkspaceVersion="1.9" AnyLogicVersion="8.7.11.202204111309" AlpVersion="8.7.3">
<Model>
	<Id>1648027099882</Id>
	<Name><![CDATA[HeatingSystems]]></Name>
	<EngineVersion>6</EngineVersion>
	<JavaPackageName><![CDATA[heatingsystems]]></JavaPackageName>
	<ModelTimeUnit><![CDATA[Hour]]></ModelTimeUnit>
	<OptionLists>
		<OptionList>
			<Id>1648027299184</Id>
			<Name><![CDATA[OL_HeatingTypes]]></Name>
			<Option>
				<Id>1648027299186</Id>
				<Name><![CDATA[GasHeater]]></Name>
			</Option>
			<Option>
				<Id>1648027299188</Id>
				<Name><![CDATA[HeatPump]]></Name>
			</Option>
			<Option>
				<Id>1648027299190</Id>
				<Name><![CDATA[HeatPump_Hybrid]]></Name>
			</Option>
			<Option>
				<Id>1648027299192</Id>
				<Name><![CDATA[DistrictHeating]]></Name>
			</Option>
			<Option>
				<Id>1648027299194</Id>
				<Name><![CDATA[HeatPump_w_Boiler]]></Name>
			</Option>
			<Option>
				<Id>1648027299196</Id>
				<Name><![CDATA[DistrictHeating_w_Boiler]]></Name>
			</Option>
		</OptionList>
		<OptionList>
			<Id>1650637592055</Id>
			<Name><![CDATA[OL_HeatingTypesDH]]></Name>
			<Option>
				<Id>1650637592057</Id>
				<Name><![CDATA[GasHeater]]></Name>
			</Option>
			<Option>
				<Id>1650637592059</Id>
				<Name><![CDATA[HeatPump]]></Name>
			</Option>
			<Option>
				<Id>1650637592061</Id>
				<Name><![CDATA[HeatPump_GasPeak]]></Name>
			</Option>
			<Option>
				<Id>1650637592065</Id>
				<Name><![CDATA[HeatPump_w_Boiler]]></Name>
			</Option>
			<Option>
				<Id>1650982353550</Id>
				<Name><![CDATA[HeatPump_GasPeak_Boiler]]></Name>
			</Option>
		</OptionList>
	</OptionLists>
	<ActiveObjectClasses>
		<!--   =========   Active Object Class   ========  -->
		<ActiveObjectClass>
			<Id>1648027099888</Id>
			<Name><![CDATA[Main]]></Name>
			<ClientAreaTopLeft><X>0</X><Y>0</Y></ClientAreaTopLeft>
			<Import><![CDATA[import esdl.EnergySystem;]]></Import>
			<Generic>false</Generic>
			<GenericParameter>
				<Id>1648027099886</Id>
				<Name><![CDATA[1648027099886]]></Name>
				<GenericParameterValue Class="CodeValue">
					<Code><![CDATA[T extends Agent]]></Code>
				</GenericParameterValue>
				<GenericParameterLabel><![CDATA[Generic parameter:]]></GenericParameterLabel>
			</GenericParameter>
			<FlowChartsUsage>ENTITY</FlowChartsUsage>
			<SamplesToKeep>100</SamplesToKeep>
			<LimitNumberOfArrayElements>false</LimitNumberOfArrayElements>
			<ElementsLimitValue>100</ElementsLimitValue>
			<MakeDefaultViewArea>true</MakeDefaultViewArea>
			<SceneGridColor/>
			<SceneBackgroundColor/>
			<SceneSkybox>null</SceneSkybox>
			<AgentProperties>
	 			<SpaceType>CONTINUOUS</SpaceType>			
				<EnvironmentDefinesInitialLocation>true</EnvironmentDefinesInitialLocation>
				<RotateAnimationTowardsMovement>true</RotateAnimationTowardsMovement>
				<RotateAnimationVertically>false</RotateAnimationVertically>
				<VelocityCode Class="CodeUnitValue">
					<Code><![CDATA[10]]></Code>
					<Unit Class="SpeedUnits"><![CDATA[MPS]]></Unit>
				</VelocityCode>
				<PhysicalLength Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalLength>
				<PhysicalWidth Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalWidth>
				<PhysicalHeight Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalHeight>
			</AgentProperties>
			<EnvironmentProperties>
					<EnableSteps>false</EnableSteps>
					<StepDurationCode Class="CodeUnitValue">
						<Code><![CDATA[1.0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[SECOND]]></Unit>
					</StepDurationCode>
					<SpaceType>CONTINUOUS</SpaceType>
					<WidthCode><![CDATA[500]]></WidthCode>
					<HeightCode><![CDATA[500]]></HeightCode>
					<ZHeightCode><![CDATA[0]]></ZHeightCode>
					<ColumnsCountCode><![CDATA[100]]></ColumnsCountCode>
					<RowsCountCode><![CDATA[100]]></RowsCountCode>
					<NeigborhoodType>MOORE</NeigborhoodType>
					<LayoutType>USER_DEF</LayoutType>
					<LayoutTypeApplyOnStartup>true</LayoutTypeApplyOnStartup>
					<NetworkType>USER_DEF</NetworkType>
					<NetworkTypeApplyOnStartup>true</NetworkTypeApplyOnStartup>
					<ConnectionsPerAgentCode><![CDATA[2]]></ConnectionsPerAgentCode>
					<ConnectionsRangeCode><![CDATA[50]]></ConnectionsRangeCode>
					<NeighborLinkFractionCode><![CDATA[0.95]]></NeighborLinkFractionCode>
					<MCode><![CDATA[10]]></MCode>
			</EnvironmentProperties>
			<DatasetsCreationProperties>
				<AutoCreate>true</AutoCreate>
					<OccurrenceAtTime>true</OccurrenceAtTime>
					<OccurrenceDate>1648108800000</OccurrenceDate>
					<OccurrenceTime Class="CodeUnitValue">
						<Code><![CDATA[0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</OccurrenceTime>
					<RecurrenceCode Class="CodeUnitValue">
						<Code><![CDATA[1]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</RecurrenceCode>
			</DatasetsCreationProperties>
			<ScaleRuler>
				<Id>1648027099884</Id>
				<Name><![CDATA[scale]]></Name>
				<X>0</X><Y>-150</Y>
				<PublicFlag>false</PublicFlag>
				<PresentationFlag>false</PresentationFlag>
				<ShowLabel>false</ShowLabel>
				<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
				<Length>100</Length>
				<Rotation>0</Rotation>
				<ScaleType>BASED_ON_LENGTH</ScaleType>
				<ModelLength>10</ModelLength>
				<LengthUnits>METER</LengthUnits>
				<Scale>10</Scale>
				<InheritedFromParentAgentType>true</InheritedFromParentAgentType>
			</ScaleRuler>
			<CurrentLevel>1648027099887</CurrentLevel>
			<ConnectionsId>1648027099883</ConnectionsId>
			<Variables>
				<Variable Class="Parameter">
					<Id>1649845619325</Id>
					<Name><![CDATA[p_esdlEnergySystem]]></Name>
					<X>60</X><Y>70</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[esdl.EnergySystem]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[esdl.EsdlFactory.eINSTANCE.createEnergySystem()]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1649845619323</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
			</Variables>
			<AgentLinks>
				<AgentLink>
					<Id>1648027099883</Id>
					<Name><![CDATA[connections]]></Name>
					<X>50</X><Y>-50</Y>
					<Label><X>15</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<HandleReceiveInConnections>false</HandleReceiveInConnections>
					<AgentLinkType>COLLECTION_OF_LINKS</AgentLinkType>
					<AgentLinkBidirectional>true</AgentLinkBidirectional>
					<MessageType><![CDATA[Object]]></MessageType>
					<LineStyle>SOLID</LineStyle>
					<LineWidth>1</LineWidth>
					<LineColor>-16777216</LineColor>
					<LineZOrder>UNDER_AGENTS</LineZOrder>
					<LineArrow>NONE</LineArrow>
					<LineArrowPosition>END</LineArrowPosition>
				</AgentLink>
			</AgentLinks>

			<EmbeddedObjects>
				<EmbeddedObject>
					<Id>1649846250072</Id>
					<Name><![CDATA[Gasheater]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>60</X><Y>250</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[HeatingSystem]]></ClassName>
					</ActiveObjectClass>
					<GenericParameterSubstitute>
						<GenericParameterSubstituteReference>
							<PackageName><![CDATA[heatingsystems]]></PackageName>
							<ClassName><![CDATA[HeatingSystem]]></ClassName>
							<ItemName><![CDATA[1648027127020]]></ItemName>
						</GenericParameterSubstituteReference>
					</GenericParameterSubstitute>
					<Parameters>
						<Parameter>
							<Name><![CDATA[p_HeatingType]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[OL_HeatingTypes.GasHeater]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyPrimaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_GasHeater(Gasheater, 20)]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MySecondaryHeatingSystem]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_hybridCOPThreshold]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyBackupHeatingSystem]]></Name>
						</Parameter>
					</Parameters>
					<ReplicationFlag>false</ReplicationFlag>
					<Replication Class="CodeValue">
						<Code><![CDATA[100]]></Code>
					</Replication>
					<CollectionType>ARRAY_LIST_BASED</CollectionType>
					<InEnvironment>true</InEnvironment>	
					<InitialLocationType>AT_ANIMATION_POSITION</InitialLocationType>
					<XCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</XCode>
					<YCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</YCode>
					<ZCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ZCode>
					<ColumnCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ColumnCode>
					<RowCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</RowCode>
					<LatitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LatitudeCode>
					<LongitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LongitudeCode>
					<LocationNameCode Class="CodeValue">
						<Code><![CDATA[""]]></Code>
					</LocationNameCode>
					<InitializationType>SPECIFIED_NUMBER</InitializationType>
					<InitializationDatabaseTableQuery>
						<TableReference>
						</TableReference>
					</InitializationDatabaseTableQuery>
					<InitializationDatabaseType>ONE_AGENT_PER_DATABASE_RECORD</InitializationDatabaseType>
					<QuantityColumn>
					</QuantityColumn>
				</EmbeddedObject>
				<EmbeddedObject>
					<Id>1650009407830</Id>
					<Name><![CDATA[Heatpump]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>60</X><Y>220</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<PresentationId>1650009407832</PresentationId>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[HeatingSystem]]></ClassName>
					</ActiveObjectClass>
					<GenericParameterSubstitute>
						<GenericParameterSubstituteReference>
							<PackageName><![CDATA[heatingsystems]]></PackageName>
							<ClassName><![CDATA[HeatingSystem]]></ClassName>
							<ItemName><![CDATA[1648027127020]]></ItemName>
						</GenericParameterSubstituteReference>
					</GenericParameterSubstitute>
					<Parameters>
						<Parameter>
							<Name><![CDATA[p_HeatingType]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[OL_HeatingTypes.HeatPump]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyPrimaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_Heatpump( Heatpump, 3 , 0.95)]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MySecondaryHeatingSystem]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_hybridCOPThreshold]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyBackupHeatingSystem]]></Name>
						</Parameter>
					</Parameters>
					<ReplicationFlag>false</ReplicationFlag>
					<Replication Class="CodeValue">
						<Code><![CDATA[100]]></Code>
					</Replication>
					<CollectionType>ARRAY_LIST_BASED</CollectionType>
					<InEnvironment>true</InEnvironment>	
					<InitialLocationType>AT_ANIMATION_POSITION</InitialLocationType>
					<XCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</XCode>
					<YCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</YCode>
					<ZCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ZCode>
					<ColumnCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ColumnCode>
					<RowCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</RowCode>
					<LatitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LatitudeCode>
					<LongitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LongitudeCode>
					<LocationNameCode Class="CodeValue">
						<Code><![CDATA[""]]></Code>
					</LocationNameCode>
					<InitializationType>SPECIFIED_NUMBER</InitializationType>
					<InitializationDatabaseTableQuery>
						<TableReference>
						</TableReference>
					</InitializationDatabaseTableQuery>
					<InitializationDatabaseType>ONE_AGENT_PER_DATABASE_RECORD</InitializationDatabaseType>
					<QuantityColumn>
					</QuantityColumn>
				</EmbeddedObject>
				<EmbeddedObject>
					<Id>1650010694129</Id>
					<Name><![CDATA[HybridHeatpump]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>60</X><Y>280</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[HeatingSystem]]></ClassName>
					</ActiveObjectClass>
					<GenericParameterSubstitute>
						<GenericParameterSubstituteReference>
							<PackageName><![CDATA[heatingsystems]]></PackageName>
							<ClassName><![CDATA[HeatingSystem]]></ClassName>
							<ItemName><![CDATA[1648027127020]]></ItemName>
						</GenericParameterSubstituteReference>
					</GenericParameterSubstitute>
					<Parameters>
						<Parameter>
							<Name><![CDATA[p_HeatingType]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[OL_HeatingTypes.HeatPump_Hybrid]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyPrimaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_Heatpump( HybridHeatpump, 3, 0.5 )]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MySecondaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_GasHeater( HybridHeatpump, 20 )]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_hybridCOPThreshold]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyBackupHeatingSystem]]></Name>
						</Parameter>
					</Parameters>
					<ReplicationFlag>false</ReplicationFlag>
					<Replication Class="CodeValue">
						<Code><![CDATA[100]]></Code>
					</Replication>
					<CollectionType>ARRAY_LIST_BASED</CollectionType>
					<InEnvironment>true</InEnvironment>	
					<InitialLocationType>AT_ANIMATION_POSITION</InitialLocationType>
					<XCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</XCode>
					<YCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</YCode>
					<ZCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ZCode>
					<ColumnCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ColumnCode>
					<RowCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</RowCode>
					<LatitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LatitudeCode>
					<LongitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LongitudeCode>
					<LocationNameCode Class="CodeValue">
						<Code><![CDATA[""]]></Code>
					</LocationNameCode>
					<InitializationType>SPECIFIED_NUMBER</InitializationType>
					<InitializationDatabaseTableQuery>
						<TableReference>
						</TableReference>
					</InitializationDatabaseTableQuery>
					<InitializationDatabaseType>ONE_AGENT_PER_DATABASE_RECORD</InitializationDatabaseType>
					<QuantityColumn>
					</QuantityColumn>
				</EmbeddedObject>
				<EmbeddedObject>
					<Id>1650010824551</Id>
					<Name><![CDATA[HeatpumpBoiler]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>60</X><Y>310</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[HeatingSystem]]></ClassName>
					</ActiveObjectClass>
					<GenericParameterSubstitute>
						<GenericParameterSubstituteReference>
							<PackageName><![CDATA[heatingsystems]]></PackageName>
							<ClassName><![CDATA[HeatingSystem]]></ClassName>
							<ItemName><![CDATA[1648027127020]]></ItemName>
						</GenericParameterSubstituteReference>
					</GenericParameterSubstitute>
					<Parameters>
						<Parameter>
							<Name><![CDATA[p_HeatingType]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[OL_HeatingTypes.HeatPump_w_Boiler]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyPrimaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_Heatpump( HeatpumpBoiler, 3 , 0.5)]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MySecondaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_Boiler( HeatpumpBoiler, 10.0 )]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_hybridCOPThreshold]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyBackupHeatingSystem]]></Name>
						</Parameter>
					</Parameters>
					<ReplicationFlag>false</ReplicationFlag>
					<Replication Class="CodeValue">
						<Code><![CDATA[100]]></Code>
					</Replication>
					<CollectionType>ARRAY_LIST_BASED</CollectionType>
					<InEnvironment>true</InEnvironment>	
					<InitialLocationType>AT_ANIMATION_POSITION</InitialLocationType>
					<XCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</XCode>
					<YCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</YCode>
					<ZCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ZCode>
					<ColumnCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ColumnCode>
					<RowCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</RowCode>
					<LatitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LatitudeCode>
					<LongitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LongitudeCode>
					<LocationNameCode Class="CodeValue">
						<Code><![CDATA[""]]></Code>
					</LocationNameCode>
					<InitializationType>SPECIFIED_NUMBER</InitializationType>
					<InitializationDatabaseTableQuery>
						<TableReference>
						</TableReference>
					</InitializationDatabaseTableQuery>
					<InitializationDatabaseType>ONE_AGENT_PER_DATABASE_RECORD</InitializationDatabaseType>
					<QuantityColumn>
					</QuantityColumn>
				</EmbeddedObject>
				<EmbeddedObject>
					<Id>1650010859240</Id>
					<Name><![CDATA[DistrictHeating]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>60</X><Y>340</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[HeatingSystem]]></ClassName>
					</ActiveObjectClass>
					<GenericParameterSubstitute>
						<GenericParameterSubstituteReference>
							<PackageName><![CDATA[heatingsystems]]></PackageName>
							<ClassName><![CDATA[HeatingSystem]]></ClassName>
							<ItemName><![CDATA[1648027127020]]></ItemName>
						</GenericParameterSubstituteReference>
					</GenericParameterSubstitute>
					<Parameters>
						<Parameter>
							<Name><![CDATA[p_HeatingType]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[OL_HeatingTypes.DistrictHeating]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyPrimaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_DistrictHeatingCon( DistrictHeating, 10.0 )]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MySecondaryHeatingSystem]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_hybridCOPThreshold]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyBackupHeatingSystem]]></Name>
						</Parameter>
					</Parameters>
					<ReplicationFlag>false</ReplicationFlag>
					<Replication Class="CodeValue">
						<Code><![CDATA[100]]></Code>
					</Replication>
					<CollectionType>ARRAY_LIST_BASED</CollectionType>
					<InEnvironment>true</InEnvironment>	
					<InitialLocationType>AT_ANIMATION_POSITION</InitialLocationType>
					<XCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</XCode>
					<YCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</YCode>
					<ZCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ZCode>
					<ColumnCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ColumnCode>
					<RowCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</RowCode>
					<LatitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LatitudeCode>
					<LongitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LongitudeCode>
					<LocationNameCode Class="CodeValue">
						<Code><![CDATA[""]]></Code>
					</LocationNameCode>
					<InitializationType>SPECIFIED_NUMBER</InitializationType>
					<InitializationDatabaseTableQuery>
						<TableReference>
						</TableReference>
					</InitializationDatabaseTableQuery>
					<InitializationDatabaseType>ONE_AGENT_PER_DATABASE_RECORD</InitializationDatabaseType>
					<QuantityColumn>
					</QuantityColumn>
				</EmbeddedObject>
				<EmbeddedObject>
					<Id>1650010902553</Id>
					<Name><![CDATA[DistrictHeatingBoiler]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>60</X><Y>370</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[HeatingSystem]]></ClassName>
					</ActiveObjectClass>
					<GenericParameterSubstitute>
						<GenericParameterSubstituteReference>
							<PackageName><![CDATA[heatingsystems]]></PackageName>
							<ClassName><![CDATA[HeatingSystem]]></ClassName>
							<ItemName><![CDATA[1648027127020]]></ItemName>
						</GenericParameterSubstituteReference>
					</GenericParameterSubstitute>
					<Parameters>
						<Parameter>
							<Name><![CDATA[p_HeatingType]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[OL_HeatingTypes.DistrictHeating_w_Boiler]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyPrimaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_DistrictHeatingCon( DistrictHeatingBoiler, 10.0 )]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MySecondaryHeatingSystem]]></Name>
							<Value Class="CodeValue">
								<Code><![CDATA[new J_Boiler( DistrictHeatingBoiler, 10.0 )]]></Code>
							</Value>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_hybridCOPThreshold]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyBackupHeatingSystem]]></Name>
						</Parameter>
					</Parameters>
					<ReplicationFlag>false</ReplicationFlag>
					<Replication Class="CodeValue">
						<Code><![CDATA[100]]></Code>
					</Replication>
					<CollectionType>ARRAY_LIST_BASED</CollectionType>
					<InEnvironment>true</InEnvironment>	
					<InitialLocationType>AT_ANIMATION_POSITION</InitialLocationType>
					<XCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</XCode>
					<YCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</YCode>
					<ZCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ZCode>
					<ColumnCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ColumnCode>
					<RowCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</RowCode>
					<LatitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LatitudeCode>
					<LongitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LongitudeCode>
					<LocationNameCode Class="CodeValue">
						<Code><![CDATA[""]]></Code>
					</LocationNameCode>
					<InitializationType>SPECIFIED_NUMBER</InitializationType>
					<InitializationDatabaseTableQuery>
						<TableReference>
						</TableReference>
					</InitializationDatabaseTableQuery>
					<InitializationDatabaseType>ONE_AGENT_PER_DATABASE_RECORD</InitializationDatabaseType>
					<QuantityColumn>
					</QuantityColumn>
				</EmbeddedObject>
			</EmbeddedObjects>

			<Presentation>
				<Level>
					<Id>1648027099887</Id>
					<Name><![CDATA[level]]></Name>
					<X>0</X><Y>0</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<Z>0</Z>
					<LevelVisibility>DIM_NON_CURRENT</LevelVisibility>

			<Presentation>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1649847195666</Id>
					<Name><![CDATA[button1]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>300</X><Y>30</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="170" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[public static EnergySystem loadESDLModel(String fileName) throws IOException {
        // Initialize the model
        EsdlPackage.eINSTANCE.eClass();
        XMIResource resource = new XMIResourceImpl(URI.createURI(fileName));
        resource.load(null);
        return (EnergySystem) resource.getContents().get(0);
}]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[save esdl energy system]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Text>
					<Id>1650010788885</Id>
					<Name><![CDATA[text]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>50</X><Y>170</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[These populations are for testing the heatingsystems. They do not exist in de Ebuurt model]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>14</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
			</Presentation>

				</Level>
				<EmbeddedObjectPresentation>
					<Id>1650009407832</Id>
					<Name><![CDATA[Heatpump_presentation]]></Name>
					<X>230</X><Y>50</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<DrawingMode>AGENT_CURRENT_POSITION</DrawingMode>
					<ScaleType>AUTOMATICALLY_CALCULATED</ScaleType>
					<GISScaleForRealEmbeddedObjectPresentationSize>1000</GISScaleForRealEmbeddedObjectPresentationSize>
					<GISScaleForFixedEmbeddedObjectPresentationSize>1000000000</GISScaleForFixedEmbeddedObjectPresentationSize>
					<Latitude>0.0</Latitude>
					<Longitude>0.0</Longitude>
				</EmbeddedObjectPresentation>
			</Presentation>

		</ActiveObjectClass>
		<!--   =========   Active Object Class   ========  -->
		<ActiveObjectClass>
			<Id>1648027127025</Id>
			<Name><![CDATA[HeatingSystem]]></Name>
			<ClientAreaTopLeft><X>0</X><Y>0</Y></ClientAreaTopLeft>
			<Generic>false</Generic>
			<GenericParameter>
				<Id>1648027127020</Id>
				<Name><![CDATA[1648027127020]]></Name>
				<GenericParameterValue Class="CodeValue">
					<Code><![CDATA[T extends Agent]]></Code>
				</GenericParameterValue>
				<GenericParameterLabel><![CDATA[Generic parameter:]]></GenericParameterLabel>
			</GenericParameter>
			<FlowChartsUsage>ENTITY</FlowChartsUsage>
			<SamplesToKeep>100</SamplesToKeep>
			<LimitNumberOfArrayElements>true</LimitNumberOfArrayElements>
			<ElementsLimitValue>100</ElementsLimitValue>
			<MakeDefaultViewArea>true</MakeDefaultViewArea>
			<SceneGridColor/>
			<SceneBackgroundColor/>
			<SceneSkybox>null</SceneSkybox>
			<AgentProperties>
	 			<SpaceType>CONTINUOUS</SpaceType>			
				<EnvironmentDefinesInitialLocation>true</EnvironmentDefinesInitialLocation>
				<RotateAnimationTowardsMovement>true</RotateAnimationTowardsMovement>
				<RotateAnimationVertically>false</RotateAnimationVertically>
				<VelocityCode Class="CodeUnitValue">
					<Code><![CDATA[10]]></Code>
					<Unit Class="SpeedUnits"><![CDATA[MPS]]></Unit>
				</VelocityCode>
				<PhysicalLength Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalLength>
				<PhysicalWidth Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalWidth>
				<PhysicalHeight Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalHeight>
			</AgentProperties>
			<EnvironmentProperties>
					<EnableSteps>false</EnableSteps>
					<StepDurationCode Class="CodeUnitValue">
						<Code><![CDATA[1.0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[SECOND]]></Unit>
					</StepDurationCode>
					<SpaceType>CONTINUOUS</SpaceType>
					<WidthCode><![CDATA[500]]></WidthCode>
					<HeightCode><![CDATA[500]]></HeightCode>
					<ZHeightCode><![CDATA[0]]></ZHeightCode>
					<ColumnsCountCode><![CDATA[100]]></ColumnsCountCode>
					<RowsCountCode><![CDATA[100]]></RowsCountCode>
					<NeigborhoodType>MOORE</NeigborhoodType>
					<LayoutType>USER_DEF</LayoutType>
					<LayoutTypeApplyOnStartup>true</LayoutTypeApplyOnStartup>
					<NetworkType>USER_DEF</NetworkType>
					<NetworkTypeApplyOnStartup>true</NetworkTypeApplyOnStartup>
					<ConnectionsPerAgentCode><![CDATA[2]]></ConnectionsPerAgentCode>
					<ConnectionsRangeCode><![CDATA[50]]></ConnectionsRangeCode>
					<NeighborLinkFractionCode><![CDATA[0.95]]></NeighborLinkFractionCode>
					<MCode><![CDATA[10]]></MCode>
			</EnvironmentProperties>
			<DatasetsCreationProperties>
				<AutoCreate>true</AutoCreate>
					<OccurrenceAtTime>true</OccurrenceAtTime>
					<OccurrenceDate>1645084800000</OccurrenceDate>
					<OccurrenceTime Class="CodeUnitValue">
						<Code><![CDATA[0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</OccurrenceTime>
					<RecurrenceCode Class="CodeUnitValue">
						<Code><![CDATA[1]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</RecurrenceCode>
			</DatasetsCreationProperties>
			<ScaleRuler>
				<Id>1648027127021</Id>
				<Name><![CDATA[scale]]></Name>
				<X>0</X><Y>-150</Y>
				<PublicFlag>false</PublicFlag>
				<PresentationFlag>false</PresentationFlag>
				<ShowLabel>false</ShowLabel>
				<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
				<Length>100</Length>
				<Rotation>0</Rotation>
				<ScaleType>BASED_ON_LENGTH</ScaleType>
				<ModelLength>10</ModelLength>
				<LengthUnits>METER</LengthUnits>
				<Scale>10</Scale>
				<InheritedFromParentAgentType>true</InheritedFromParentAgentType>
			</ScaleRuler>
			<ConnectionsId>1648027127099</ConnectionsId>
			<Variables>
				<Variable Class="PlainVariable">
					<Id>1648027127045</Id>
					<Name><![CDATA[v_heatDelivery_kW]]></Name>
					<X>70</X><Y>220</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1648027127051</Id>
					<Name><![CDATA[v_HeatDelivered_kWh]]></Name>
					<X>280</X><Y>220</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1648049849703</Id>
					<Name><![CDATA[v_hotWaterDelivery_kW]]></Name>
					<X>70</X><Y>250</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1648049849707</Id>
					<Name><![CDATA[v_hotWaterDelivered_kWh]]></Name>
					<X>280</X><Y>250</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1648287795462</Id>
					<Name><![CDATA[v_HeatRequested_kW]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 26-03-2022]]></Description>
					<X>70</X><Y>380</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1648287814208</Id>
					<Name><![CDATA[v_HotWaterRequested_kW]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 26-03-2022]]></Description>
					<X>70</X><Y>410</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1649776622755</Id>
					<Name><![CDATA[v_GasConsumption_m3ph]]></Name>
					<X>70</X><Y>280</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1649776622757</Id>
					<Name><![CDATA[v_CumGasConsumed_m3]]></Name>
					<X>280</X><Y>280</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1649842330132</Id>
					<Name><![CDATA[v_ElectricityConsumption_kW]]></Name>
					<X>70</X><Y>310</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1649842344705</Id>
					<Name><![CDATA[v_CumElectricityConsumed_kWh]]></Name>
					<X>280</X><Y>310</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650443578372</Id>
					<Name><![CDATA[v_DistrictHeatingAbsorption_kW]]></Name>
					<X>70</X><Y>340</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650443578375</Id>
					<Name><![CDATA[v_DistrictHeatingAbsorbed_kWh]]></Name>
					<X>280</X><Y>340</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1651907958197</Id>
					<Name><![CDATA[v_HotWaterDebt_kWh]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 26-03-2022]]></Description>
					<X>70</X><Y>450</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="Parameter">
					<Id>1649759591179</Id>
					<Name><![CDATA[p_HeatingType]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 13/04/2022]]></Description>
					<X>70</X><Y>80</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[OL_HeatingTypes]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<ParameterEditor>
							<Id>1649759591177</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1649859293772</Id>
					<Name><![CDATA[p_MyPrimaryHeatingSystem]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>70</X><Y>110</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[Object]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<ParameterEditor>
							<Id>1649859293770</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1649925067547</Id>
					<Name><![CDATA[p_MySecondaryHeatingSystem]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>70</X><Y>140</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[Object]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<ParameterEditor>
							<Id>1649925067545</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650018309361</Id>
					<Name><![CDATA[p_hybridCOPThreshold]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>70</X><Y>195</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[2.5]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650018309359</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650982169130</Id>
					<Name><![CDATA[p_MyBackupHeatingSystem]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>70</X><Y>170</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[Object]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<ParameterEditor>
							<Id>1650982169128</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
			</Variables>
			<Functions>
				<Function AccessType="public" StaticFunction="false">
					<ReturnModificator>VOID</ReturnModificator>
					<ReturnType><![CDATA[double]]></ReturnType>
					<Id>1648051511331</Id>
					<Name><![CDATA[f_CalculateHeatAndWaterProduction]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 14-04-2022]]></Description>
					<X>60</X><Y>660</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>false</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Parameter>
						<Name><![CDATA[heatRequest_kW]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[hotWaterRequest_kW]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[baseTemperatureHeating]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[destinationTemperatureHeating]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[baseTemperatureHotWater]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[destinationTemperatureHotWater]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[etafactor]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[timeStep_HR]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Body><![CDATA[//Reset waarden voor tijdstap
v_heatDelivery_kW = 0;
v_hotWaterDelivery_kW = 0;
v_GasConsumption_m3ph = 0;
v_ElectricityConsumption_kW = 0;
v_DistrictHeatingAbsorption_kW = 0;

//Initialiseer lokale variabelen
J_GasHeater gasheater;
J_Heatpump heatpump;
J_Boiler boiler;
J_DistrictHeatingCon districtHeatingCon;
double COPheating;
double COPwater;
//double etaHeatpump_f = etafactor;   // heatpump efficiency factor for calculating COP with temperature deltas

//traceln("eta "+etaHeatpump_f);
//traceln(" baseTempHeating" + baseTemperatureHeating);
//traceln(" destinationtempHeating" +destinationTemperatureHeating);
//traceln(" baseTempHotwater" + baseTemperatureHotWater);
//traceln(" destinationtempHotwater" +destinationTemperatureHotWater);
//COPheating = etaHeatpump_f * ( 273.15 + destinationTemperatureHeating ) / (destinationTemperatureHeating - baseTemperatureHeating);
//COPwater = etaHeatpump_f * ( 273.15 + destinationTemperatureHotWater ) / (destinationTemperatureHotWater - baseTemperatureHotWater);
//traceln("COP heating: "+COPheating);
//traceln("COP water: "+COPwater);
//Zet de warmte vraag van deze staat stap
v_HeatRequested_kW = heatRequest_kW;
v_HotWaterRequested_kW = hotWaterRequest_kW + v_HotWaterDebt_kWh/timeStep_HR;

//Produceer warm water en warmte
switch (p_HeatingType) {
	case GasHeater:
		gasheater = (J_GasHeater)p_MyPrimaryHeatingSystem;
		v_hotWaterDelivery_kW += gasheater.produceHotWater( v_HotWaterRequested_kW, true );
		v_heatDelivery_kW += gasheater.produceHeat( v_HeatRequested_kW, false );
		v_GasConsumption_m3ph = gasheater.getGasConsumption();
	break;
	
	case HeatPump:
		//COPwater = tf_heatPumpCOPhotWater( temperatureOutside );
		//t_COPWater.setText("COP water = " + COPwater);
		//COPheating = tf_heatPumpCOPspaceHeating( temperatureOutside );
		//t_COPHeat.setText("COP Heating = " + COPheating);
		heatpump = (J_Heatpump)p_MyPrimaryHeatingSystem;
		v_hotWaterDelivery_kW += heatpump.produceHotWater( v_HotWaterRequested_kW, baseTemperatureHotWater, destinationTemperatureHotWater, true);
		v_heatDelivery_kW += heatpump.produceHeat(v_HeatRequested_kW, baseTemperatureHeating, destinationTemperatureHeating, false);
		v_ElectricityConsumption_kW = heatpump.getElectricityConsumption();
	break;
	
	case HeatPump_w_Boiler:
		//COPheating = tf_heatPumpCOPspaceHeating( temperatureOutside );
		//t_COPHeat.setText("COP Heating = " + COPheating);
		heatpump = (J_Heatpump)p_MyPrimaryHeatingSystem;
		boiler = (J_Boiler)p_MySecondaryHeatingSystem;
		v_heatDelivery_kW += heatpump.produceHeat( v_HeatRequested_kW, baseTemperatureHeating, destinationTemperatureHeating, true );
		v_hotWaterDelivery_kW += boiler.produceHotWater( v_HotWaterRequested_kW );
		v_ElectricityConsumption_kW = heatpump.getElectricityConsumption() + boiler.getElectricityConsumption();
	break;
	
	case HeatPump_Hybrid:
		//COPheating = tf_heatPumpCOPspaceHeating( temperatureOutside );
		//t_COPHeat.setText("COP Heating = " + COPheating);
		heatpump = (J_Heatpump)p_MyPrimaryHeatingSystem;
		gasheater = (J_GasHeater)p_MySecondaryHeatingSystem;
		COPheating = heatpump.getCOP(baseTemperatureHeating, destinationTemperatureHeating);
		if ( COPheating < p_hybridCOPThreshold ) {
			v_hotWaterDelivery_kW += gasheater.produceHotWater( v_HotWaterRequested_kW, true );
			v_heatDelivery_kW += gasheater.produceHeat( v_HeatRequested_kW, false );
			v_GasConsumption_m3ph = gasheater.getGasConsumption();
		} else {
			v_hotWaterDelivery_kW += gasheater.produceHotWater( v_HotWaterRequested_kW, true );
			v_GasConsumption_m3ph = gasheater.getGasConsumption();
			v_heatDelivery_kW += heatpump.produceHeat( v_HeatRequested_kW, baseTemperatureHeating, destinationTemperatureHeating, true );
			v_ElectricityConsumption_kW = heatpump.getElectricityConsumption();
		}
	break;
	
	case DistrictHeating:
		districtHeatingCon = (J_DistrictHeatingCon)p_MyPrimaryHeatingSystem;
		v_hotWaterDelivery_kW += districtHeatingCon.deliverHotWater( v_HotWaterRequested_kW, true );
		v_heatDelivery_kW += districtHeatingCon.deliverHeat( v_HeatRequested_kW, false );
		v_DistrictHeatingAbsorption_kW = districtHeatingCon.getAbsorption();
	break;
	
	case DistrictHeating_w_Boiler:
		districtHeatingCon = (J_DistrictHeatingCon)p_MyPrimaryHeatingSystem;
		boiler = (J_Boiler)p_MySecondaryHeatingSystem;
		double hotWaterTemp_degC = 65;
		v_heatDelivery_kW += districtHeatingCon.deliverHeat(v_HeatRequested_kW+v_HotWaterRequested_kW*(50-10)/(hotWaterTemp_degC-10), true); // Include part of hotwater request, for heating 10deg tapwater to 50 deg
		v_DistrictHeatingAbsorption_kW = districtHeatingCon.getAbsorption();
		v_hotWaterDelivery_kW += boiler.produceHotWater(v_HotWaterRequested_kW*(hotWaterTemp_degC-50)/(hotWaterTemp_degC-10)); // Boiler only has to take care of last 20 deg heatup from 50 to 70 degrees.
		v_ElectricityConsumption_kW = boiler.getElectricityConsumption();
	break;
	
	default:
		error("no correct heating system in place");
}

v_HotWaterDebt_kWh += (hotWaterRequest_kW - v_hotWaterDelivery_kW) * timeStep_HR;
plot.updateData();

//Bereken totalen van deze tijdstap
v_HeatDelivered_kWh += v_heatDelivery_kW * timeStep_HR ;
v_hotWaterDelivered_kWh += v_hotWaterDelivery_kW * timeStep_HR ;
v_CumGasConsumed_m3 += v_GasConsumption_m3ph * timeStep_HR;
v_CumElectricityConsumed_kWh += v_ElectricityConsumption_kW * timeStep_HR;
v_DistrictHeatingAbsorbed_kWh += v_DistrictHeatingAbsorption_kW * timeStep_HR;]]></Body>
				</Function>
			</Functions>
			<TableFunctions>
				<TableFunction AccessType="public" StaticFunction="false">
					<Id>1649761112277</Id>
					<Name><![CDATA[tf_heatPumpCOPspaceHeating]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>60</X><Y>690</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>false</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<InterpolationMethod>LINEAR</InterpolationMethod>
					<OutOfRangeBehaviour>EXTRAPOLATE</OutOfRangeBehaviour>
					<OutOfRangeCustomValue><![CDATA[0.0]]></OutOfRangeCustomValue>
					<ApproximationOrder><![CDATA[1]]></ApproximationOrder>
					<LoadFromDatabase><![CDATA[false]]></LoadFromDatabase>
					<ValuesQuery>
						<TableReference>
						</TableReference>
							<ArgumentColumnReference>
							</ArgumentColumnReference>
							<ValueColumnReference>
							</ValueColumnReference>
					</ValuesQuery>
// arguments and values
					<Argument><![CDATA[-10.0]]></Argument>
					<Argument><![CDATA[0.0]]></Argument>
					<Argument><![CDATA[10.0]]></Argument>
					<Argument><![CDATA[20.0]]></Argument>
					<Value><![CDATA[1.5]]></Value>
					<Value><![CDATA[2.0]]></Value>
					<Value><![CDATA[3.0]]></Value>
					<Value><![CDATA[4.0]]></Value>
				</TableFunction>
				<TableFunction AccessType="public" StaticFunction="false">
					<Id>1649761112289</Id>
					<Name><![CDATA[tf_heatPumpCOPhotWater]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>60</X><Y>720</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>false</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<InterpolationMethod>LINEAR</InterpolationMethod>
					<OutOfRangeBehaviour>EXTRAPOLATE</OutOfRangeBehaviour>
					<OutOfRangeCustomValue><![CDATA[0.0]]></OutOfRangeCustomValue>
					<ApproximationOrder><![CDATA[1]]></ApproximationOrder>
					<LoadFromDatabase><![CDATA[false]]></LoadFromDatabase>
					<ValuesQuery>
						<TableReference>
						</TableReference>
							<ArgumentColumnReference>
							</ArgumentColumnReference>
							<ValueColumnReference>
							</ValueColumnReference>
					</ValuesQuery>
// arguments and values
					<Argument><![CDATA[-10.0]]></Argument>
					<Argument><![CDATA[0.0]]></Argument>
					<Argument><![CDATA[10.0]]></Argument>
					<Argument><![CDATA[20.0]]></Argument>
					<Value><![CDATA[1.0]]></Value>
					<Value><![CDATA[1.5]]></Value>
					<Value><![CDATA[2.0]]></Value>
					<Value><![CDATA[3.0]]></Value>
				</TableFunction>
			</TableFunctions>
			<AgentLinks>
				<AgentLink>
					<Id>1648027127097</Id>
					<Name><![CDATA[connections]]></Name>
					<X>50</X><Y>-50</Y>
					<Label><X>15</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<HandleReceiveInConnections>false</HandleReceiveInConnections>
					<AgentLinkType>COLLECTION_OF_LINKS</AgentLinkType>
					<AgentLinkBidirectional>false</AgentLinkBidirectional>
					<MessageType><![CDATA[Object]]></MessageType>
					<LineStyle>SOLID</LineStyle>
					<LineWidth>1</LineWidth>
					<LineColor>-16777216</LineColor>
					<LineZOrder>UNDER_AGENTS</LineZOrder>
					<LineArrow>NONE</LineArrow>
					<LineArrowPosition>END</LineArrowPosition>
				</AgentLink>
				<AgentLink>
					<Id>1648027127099</Id>
					<Name><![CDATA[connections]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>140</X><Y>-90</Y>
					<Label><X>15</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<HandleReceiveInConnections>false</HandleReceiveInConnections>
					<AgentLinkType>COLLECTION_OF_LINKS</AgentLinkType>
					<AgentLinkBidirectional>true</AgentLinkBidirectional>
					<MessageType><![CDATA[Object]]></MessageType>
					<LineStyle>SOLID</LineStyle>
					<LineWidth>1</LineWidth>
					<LineColor>-16777216</LineColor>
					<LineZOrder>UNDER_AGENTS</LineZOrder>
					<LineArrow>NONE</LineArrow>
					<LineArrowPosition>END</LineArrowPosition>
				</AgentLink>
			</AgentLinks>

			<ContainerLinks>
				<ContainerLink>
					<Id>1649846252537</Id>
					<Name><![CDATA[main]]></Name>
					<X>50</X><Y>-100</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[Main]]></ClassName>
					</ActiveObjectClass>
				</ContainerLink>
				<ContainerLink>
					<Id>1650876368508</Id>
					<Name><![CDATA[dH_PTESWithHeatPump]]></Name>
					<X>150</X><Y>-150</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[DH_PTESWithHeatPump]]></ClassName>
					</ActiveObjectClass>
				</ContainerLink>
			</ContainerLinks>

			<Presentation>
				<Level>
					<Id>1648027127065</Id>
					<Name><![CDATA[level]]></Name>
					<X>0</X><Y>0</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<Z>0</Z>
					<LevelVisibility>DIM_NON_CURRENT</LevelVisibility>


				</Level>
				<Text>
					<Id>1648048948043</Id>
					<Name><![CDATA[text]]></Name>
					<X>70</X><Y>30</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[Heating System]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>18</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
    			<TimePlot>
					<Id>1648287865350</Id>
					<Name><![CDATA[plot]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 26-03-2022]]></Description>
					<X>240</X><Y>350</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<AutoUpdate>false</AutoUpdate>
					<OccurrenceAtTime>true</OccurrenceAtTime>
					<OccurrenceDate>1648368000000</OccurrenceDate>
					<OccurrenceTime Class="CodeUnitValue">
						<Code><![CDATA[15]]></Code>
						<Unit Class="TimeUnits"><![CDATA[MINUTE]]></Unit>
					</OccurrenceTime>
					<RecurrenceCode Class="CodeUnitValue">
						<Code><![CDATA[15]]></Code>
						<Unit Class="TimeUnits"><![CDATA[MINUTE]]></Unit>
					</RecurrenceCode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Width>410</Width>
					<Height>270</Height>
					<BackgroundColor/>
					<BorderColor/>
					<ChartArea>
						<XOffset>50</XOffset>
						<YOffset>30</YOffset>
						<Width>330</Width>
						<Height>160</Height>
						<BackgroundColor>-1</BackgroundColor>
						<BorderColor>-16777216</BorderColor>
						<GridColor>-12566464</GridColor>
					</ChartArea>
					<Legend>
						<Place>SOUTH</Place>
						<TextColor>-16777216</TextColor>
						<Size>50</Size>
					</Legend>
					<Labels>
						<HorLabelsPosition>DEFAULT</HorLabelsPosition>
						<VerLabelsPosition>DEFAULT</VerLabelsPosition>
						<TextColor>-12566464</TextColor>
					</Labels>
					<ShowLegend>true</ShowLegend>
					<TimeWindowsMovementType>MOVEMENT_WITH_TIME</TimeWindowsMovementType>		
					<TimeWindowUnits>DAY</TimeWindowUnits>
					<VerScaleFromExpression><![CDATA[0]]></VerScaleFromExpression>
					<VerScaleToExpression><![CDATA[1]]></VerScaleToExpression>
					<VerScaleType>AUTO</VerScaleType>
					<DrawLine>true</DrawLine>
					<Interpolation>LINEAR</Interpolation>
					<DatasetExpression>  
						<Title><![CDATA[Heat requested [kW]]]></Title>
					<Id>0</Id>
					<Expression><![CDATA[my_dataset]]></Expression>
					<Color>-13447886</Color>
					<Expression2><![CDATA[v_HeatRequested_kW]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>NONE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<DatasetExpression>  
						<Title><![CDATA[Heat delivered [kW]]]></Title>
					<Id>0</Id>
					<Expression><![CDATA[my_dataset1]]></Expression>
					<Color>-16744448</Color>
					<Expression2><![CDATA[v_heatDelivery_kW]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>CIRCLE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<DatasetExpression>  
						<Title><![CDATA[Hot water requested [kW]]]></Title>
					<Id>0</Id>
					<Expression><![CDATA[my_dataset2]]></Expression>
					<Color>-16711681</Color>
					<Expression2><![CDATA[v_HotWaterRequested_kW]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>NONE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<DatasetExpression>  
						<Title><![CDATA[Hot water delivered [kW]]]></Title>
					<Id>0</Id>
					<Expression><![CDATA[my_dataset3]]></Expression>
					<Color>-14774017</Color>
					<Expression2><![CDATA[v_hotWaterDelivery_kW]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>CIRCLE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<SamplesToKeep>192</SamplesToKeep>
					<TimeWindowExpression><![CDATA[2]]></TimeWindowExpression>
					<FillAreaUnderLine>false</FillAreaUnderLine>
					<LabelFormat>HH_mm</LabelFormat>
    			</TimePlot>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650008913503</Id>
					<Name><![CDATA[button]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>640</X><Y>50</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(2, 1, 10, 0.25);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send ( 2, 1, 10, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650008940137</Id>
					<Name><![CDATA[button1]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>640</X><Y>130</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(0, 0, 10, 0.25);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send ( 0, 0, 10, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650008956752</Id>
					<Name><![CDATA[button2]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>640</X><Y>90</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(2, 1, 10, 1);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send ( 2, 1, 10, 1 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650008974513</Id>
					<Name><![CDATA[button3]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>640</X><Y>170</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction( 20, 100, 30, 0.25 );]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send ( 20, 100, 30, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650009288215</Id>
					<Name><![CDATA[button4]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>640</X><Y>210</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction( 25, 100, 30, 0.25 );]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send ( 25, 100, 30, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650009302960</Id>
					<Name><![CDATA[button5]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>640</X><Y>250</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction( 15, 3, 30, 0.25 );]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send ( 15, 3, 30, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650009539251</Id>
					<Name><![CDATA[button6]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>820</X><Y>50</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(2, 1, 30, 0.25);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send ( 2, 1, 30, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Text>
					<Id>1650009545487</Id>
					<Name><![CDATA[text2]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>590</X><Y>10</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[Test the heating system Should not be used during EBuurt simulation]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>14</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650009614496</Id>
					<Name><![CDATA[button7]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>820</X><Y>90</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(0, 1, 15, 0.25);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send (0, 1, 15, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650009639440</Id>
					<Name><![CDATA[button8]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>820</X><Y>210</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(1, 0, 15, 0.25);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send (1, 0, 15, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Text>
					<Id>1650009665767</Id>
					<Name><![CDATA[t_COPWater]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>60</X><Y>500</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>false</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[COP water]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>12</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
				<Text>
					<Id>1650009779407</Id>
					<Name><![CDATA[t_COPHeat]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 15-04-2022]]></Description>
					<X>60</X><Y>520</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>false</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[COP heating]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>12</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650010374455</Id>
					<Name><![CDATA[button9]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>820</X><Y>130</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(0, 1, -10, 0.25);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send ((0, 1, -10, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650010394663</Id>
					<Name><![CDATA[button10]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>820</X><Y>170</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(0, 50, -10, 0.25);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send (0, 50, -10, 0.25)]]></LabelText>
					</ExtendedProperties>
				</Control>
				<Control Type="Button">
				 	<EmbeddedIcon>false</EmbeddedIcon>				
					<Id>1650010565318</Id>
					<Name><![CDATA[button11]]></Name>
					<ExcludeFromBuild>true</ExcludeFromBuild>
					<X>820</X><Y>250</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<BasicProperties Width="160" Height="30">
                        <EmbeddedIcon>false</EmbeddedIcon>	
						<TextColor/>
						<Enabled>true</Enabled>
						<ActionCode><![CDATA[f_CalculateHeatAndWaterProduction(50, 0, 15, 0.25);]]></ActionCode>
					</BasicProperties>
					<ExtendedProperties>
						<Font Name="Dialog" Size="11" Style="0"/>
						<LabelText><![CDATA[send (50, 0, 15, 0.25 )]]></LabelText>
					</ExtendedProperties>
				</Control>
			</Presentation>
			<Areas>
				<Area>
					<Id>1648288481962</Id>
					<Name><![CDATA[viewArea]]></Name>
					<X>0</X><Y>0</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<Title><![CDATA[]]></Title>
					<Width>1000</Width>
					<Height>600</Height>
				</Area>
			</Areas>

		</ActiveObjectClass>
		<!--   =========   Active Object Class   ========  -->
		<ActiveObjectClass>
			<Id>1650616556354</Id>
			<Name><![CDATA[DH_PTESWithHeatPump]]></Name>
			<ClientAreaTopLeft><X>0</X><Y>0</Y></ClientAreaTopLeft>
			<Generic>false</Generic>
			<GenericParameter>
				<Id>1650616556349</Id>
				<Name><![CDATA[1650616556349]]></Name>
				<GenericParameterValue Class="CodeValue">
					<Code><![CDATA[T extends Agent]]></Code>
				</GenericParameterValue>
				<GenericParameterLabel><![CDATA[Generic parameter:]]></GenericParameterLabel>
			</GenericParameter>
			<FlowChartsUsage>ENTITY</FlowChartsUsage>
			<SamplesToKeep>100</SamplesToKeep>
			<LimitNumberOfArrayElements>false</LimitNumberOfArrayElements>
			<ElementsLimitValue>100</ElementsLimitValue>
			<MakeDefaultViewArea>true</MakeDefaultViewArea>
			<SceneGridColor/>
			<SceneBackgroundColor/>
			<SceneSkybox>null</SceneSkybox>
			<AgentProperties>
	 			<SpaceType>CONTINUOUS</SpaceType>			
				<EnvironmentDefinesInitialLocation>true</EnvironmentDefinesInitialLocation>
				<RotateAnimationTowardsMovement>true</RotateAnimationTowardsMovement>
				<RotateAnimationVertically>false</RotateAnimationVertically>
				<VelocityCode Class="CodeUnitValue">
					<Code><![CDATA[10]]></Code>
					<Unit Class="SpeedUnits"><![CDATA[MPS]]></Unit>
				</VelocityCode>
				<PhysicalLength Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalLength>
				<PhysicalWidth Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalWidth>
				<PhysicalHeight Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalHeight>
			</AgentProperties>
			<EnvironmentProperties>
					<EnableSteps>false</EnableSteps>
					<StepDurationCode Class="CodeUnitValue">
						<Code><![CDATA[1.0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[SECOND]]></Unit>
					</StepDurationCode>
					<SpaceType>CONTINUOUS</SpaceType>
					<WidthCode><![CDATA[500]]></WidthCode>
					<HeightCode><![CDATA[500]]></HeightCode>
					<ZHeightCode><![CDATA[0]]></ZHeightCode>
					<ColumnsCountCode><![CDATA[100]]></ColumnsCountCode>
					<RowsCountCode><![CDATA[100]]></RowsCountCode>
					<NeigborhoodType>MOORE</NeigborhoodType>
					<LayoutType>USER_DEF</LayoutType>
					<LayoutTypeApplyOnStartup>true</LayoutTypeApplyOnStartup>
					<NetworkType>USER_DEF</NetworkType>
					<NetworkTypeApplyOnStartup>true</NetworkTypeApplyOnStartup>
					<ConnectionsPerAgentCode><![CDATA[2]]></ConnectionsPerAgentCode>
					<ConnectionsRangeCode><![CDATA[50]]></ConnectionsRangeCode>
					<NeighborLinkFractionCode><![CDATA[0.95]]></NeighborLinkFractionCode>
					<MCode><![CDATA[10]]></MCode>
			</EnvironmentProperties>
			<DatasetsCreationProperties>
				<AutoCreate>true</AutoCreate>
					<OccurrenceAtTime>true</OccurrenceAtTime>
					<OccurrenceDate>1650009600000</OccurrenceDate>
					<OccurrenceTime Class="CodeUnitValue">
						<Code><![CDATA[0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</OccurrenceTime>
					<RecurrenceCode Class="CodeUnitValue">
						<Code><![CDATA[1]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</RecurrenceCode>
			</DatasetsCreationProperties>
			<ScaleRuler>
				<Id>1650616556350</Id>
				<Name><![CDATA[scale]]></Name>
				<X>0</X><Y>-150</Y>
				<PublicFlag>false</PublicFlag>
				<PresentationFlag>false</PresentationFlag>
				<ShowLabel>false</ShowLabel>
				<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
				<Length>100</Length>
				<Rotation>0</Rotation>
				<ScaleType>BASED_ON_LENGTH</ScaleType>
				<ModelLength>10</ModelLength>
				<LengthUnits>METER</LengthUnits>
				<Scale>10</Scale>
				<InheritedFromParentAgentType>true</InheritedFromParentAgentType>
			</ScaleRuler>
			<CurrentLevel>1650616556390</CurrentLevel>
			<ConnectionsId>1650616556444</ConnectionsId>
			<Variables>
				<Variable Class="PlainVariable">
					<Id>1650616556380</Id>
					<Name><![CDATA[v_bufferTemp_degC]]></Name>
					<X>30</X><Y>220</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[55]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616556382</Id>
					<Name><![CDATA[v_primaryHeatProduction_kW]]></Name>
					<X>250</X><Y>230</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616556384</Id>
					<Name><![CDATA[v_heatPumpPowerDraw_kW]]></Name>
					<X>510</X><Y>220</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616556386</Id>
					<Name><![CDATA[v_heatDeliveryToNetwork_kW]]></Name>
					<Description><![CDATA[Source heat delivery to network, made explicit here to be usable in district heat network energy balance calculations.

@author: Gillis Hommen, Jorrit van den Houten
@since: 15/04/2022]]></Description>
					<X>30</X><Y>300</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616556388</Id>
					<Name><![CDATA[v_heatingNetworkDemand]]></Name>
					<X>30</X><Y>250</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650646764228</Id>
					<Name><![CDATA[v_secondaryHeatProduction_kW]]></Name>
					<X>250</X><Y>250</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650982638502</Id>
					<Name><![CDATA[v_backupHeatProduction_kW]]></Name>
					<X>250</X><Y>270</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616556403</Id>
					<Name><![CDATA[p_bufferVolume_m3]]></Name>
					<X>30</X><Y>40</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[6000/2]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616556401</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616556406</Id>
					<Name><![CDATA[cpWater_kJpkgK]]></Name>
					<Description><![CDATA[J/(kg K)]]></Description>
					<X>30</X><Y>60</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[4.184]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616556404</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616556421</Id>
					<Name><![CDATA[p_bufferHeatloss_kWpK]]></Name>
					<X>30</X><Y>170</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[0.01]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616556419</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616556424</Id>
					<Name><![CDATA[p_maxTempBuffer_degC]]></Name>
					<Description><![CDATA[J/(kg K)]]></Description>
					<X>30</X><Y>110</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[90]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616556422</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616556427</Id>
					<Name><![CDATA[p_minTempBuffer_degC]]></Name>
					<Description><![CDATA[J/(kg K)]]></Description>
					<X>30</X><Y>130</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[50]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616556425</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616556430</Id>
					<Name><![CDATA[p_soilTemp_degC]]></Name>
					<X>30</X><Y>150</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[10]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616556428</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616556433</Id>
					<Name><![CDATA[p_bufferSpecificHeat_kWhpK]]></Name>
					<Description><![CDATA[J/(kg K)]]></Description>
					<X>30</X><Y>80</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[p_bufferVolume_m3 * cpWater_kJpkgK / 3.6]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616556431</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616556439</Id>
					<Name><![CDATA[p_bufferTempHeatingTreshold_degC]]></Name>
					<X>30</X><Y>190</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[60]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616556437</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650633790227</Id>
					<Name><![CDATA[p_heatingType]]></Name>
					<X>250</X><Y>110</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[OL_HeatingTypesDH]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<ParameterEditor>
							<Id>1650633790225</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650637243563</Id>
					<Name><![CDATA[v_hybridCOPThreshold]]></Name>
					<X>250</X><Y>80</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[1]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650637243561</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650894409318</Id>
					<Name><![CDATA[p_primarySystemMaxPower_kW]]></Name>
					<X>250</X><Y>170</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<ParameterEditor>
							<Id>1650894409316</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650894469421</Id>
					<Name><![CDATA[p_secondarySystemMaxPower_kW]]></Name>
					<X>250</X><Y>190</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<ParameterEditor>
							<Id>1650894469419</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650982670385</Id>
					<Name><![CDATA[p_backupSystemMaxPower_kW]]></Name>
					<X>250</X><Y>210</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<ParameterEditor>
							<Id>1650982670383</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
			</Variables>
			<Functions>
				<Function AccessType="default" StaticFunction="false">
					<ReturnModificator>VOID</ReturnModificator>
					<ReturnType><![CDATA[double]]></ReturnType>
					<Id>1650616556360</Id>
					<Name><![CDATA[f_socUpdate]]></Name>
					<X>30</X><Y>280</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Parameter>
						<Name><![CDATA[heatProduction_kW]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[networkHeatDemand_kW]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[dt_h]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Body><![CDATA[double dQdt_kW = heatProduction_kW - p_bufferHeatloss_kWpK * (v_bufferTemp_degC - p_soilTemp_degC) - networkHeatDemand_kW;

v_bufferTemp_degC += dQdt_kW * dt_h / p_bufferSpecificHeat_kWhpK;
v_heatDeliveryToNetwork_kW = networkHeatDemand_kW;]]></Body>
				</Function>
				<Function AccessType="public" StaticFunction="false">
					<ReturnModificator>VOID</ReturnModificator>
					<ReturnType><![CDATA[double]]></ReturnType>
					<Id>1650616556364</Id>
					<Name><![CDATA[f_heatManager]]></Name>
					<X>480</X><Y>280</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Parameter>
						<Name><![CDATA[trafoVermogen_kW]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[v_trafoMaxPower]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[dt_h]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[connectednetwork]]></Name>
						<Type><![CDATA[DistrictHeatingNetwork]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[baseTemp_degC]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Body><![CDATA[// Leid benodigd vermogen warmtelevering uit buffer af uit delta T in warmtenet
double networkSupplyTemperature = connectednetwork.v_networkSupplyTemp_degC;
double networkReturnTemperature = connectednetwork.v_networkReturnTemp_degC;
double networkVolumeFlow = connectednetwork.v_networkWaterFlow_m3ph;
double networkHeatDemand = (cpWater_kJpkgK * 1000 * networkVolumeFlow/3600 ) * (networkSupplyTemperature - networkReturnTemperature);
//double networkHeatDemand = connectednetwork.v_networkHeatDemand_kW;  // alternative approach, more direct but less realistic wrt available information.

v_heatingNetworkDemand = networkHeatDemand;
//traceln("v_heatingNetworkDemand "+roundToDecimal(v_heatingNetworkDemand,0));

// Get heatpump COP to be able to generate heat-production setpoints corresponding to a certain electric power
J_Heatpump heatpump = (J_Heatpump)heatingSystem.p_MyPrimaryHeatingSystem;
double COP = heatpump.getCOP(baseTemp_degC, v_bufferTemp_degC);
	
// Energy manager logic for heatpump, gas heater and boiler
if (v_bufferTemp_degC < p_minTempBuffer_degC) { // If PTES temperature drops below minimum, start heating with HP and gas burner
	//traceln("Peak heating");
	t_incentiveMode.setColor(red);
	t_incentiveMode.setText("power mode");
	double availablePower_kW = max(0,v_trafoMaxPower-trafoVermogen_kW);
	double heatPumpPowerSetpoint = COP*min(availablePower_kW,p_primarySystemMaxPower_kW);
	double boilerSetpoint = max(0,-trafoVermogen_kW - p_primarySystemMaxPower_kW); // Only when more than p_primarySystemMaxPower_kW power is available)
	f_CalculateHeatProduction(heatPumpPowerSetpoint, p_secondarySystemMaxPower_kW, boilerSetpoint, baseTemp_degC, v_bufferTemp_degC, dt_h);
} else if (v_bufferTemp_degC < p_bufferTempHeatingTreshold_degC && v_bufferTemp_degC >= p_minTempBuffer_degC) { // If PTES temperature drops below heating treshold, gradually start heating with HP
	//traceln("normal heating");
	t_incentiveMode.setColor(black);
	t_incentiveMode.setText("normal");
	double availablePower_kW = max(0,v_trafoMaxPower-trafoVermogen_kW);
	double heatPumpPowerSetpoint = COP*min(availablePower_kW,min(p_primarySystemMaxPower_kW,max((p_bufferTempHeatingTreshold_degC - v_bufferTemp_degC) / (p_bufferTempHeatingTreshold_degC - p_minTempBuffer_degC) * p_primarySystemMaxPower_kW, -trafoVermogen_kW)));
	double boilerSetpoint = max(0,-trafoVermogen_kW - heatPumpPowerSetpoint/COP);
	f_CalculateHeatProduction(heatPumpPowerSetpoint,0,boilerSetpoint, baseTemp_degC, v_bufferTemp_degC, dt_h);
} else if ( trafoVermogen_kW < 0 & heatingSystem.p_MyPrimaryHeatingSystem instanceof J_Heatpump & v_bufferTemp_degC < p_maxTempBuffer_degC) { // Overvloed aan stroom in de wijk, zet het in om de PTES op te warmen
	//traceln("opportunity heating");
	double heatPumpPowerSetpoint = COP*min(p_primarySystemMaxPower_kW, -trafoVermogen_kW);
	double boilerSetpoint = max(0,-trafoVermogen_kW - heatPumpPowerSetpoint/COP);
	f_CalculateHeatProduction(heatPumpPowerSetpoint,0,boilerSetpoint, baseTemp_degC, v_bufferTemp_degC, dt_h);
//	f_CalculateHeatProduction(min(-trafoVermogen_kW,p_primarySystemMaxPower_kW) * COP, p_soilTemp_degC, v_bufferTemp_degC, dt_h);
	t_incentiveMode.setColor(green);
	t_incentiveMode.setText("opportunity");
} else { // Anders verwarming uit
	f_CalculateHeatProduction(0,0,0, baseTemp_degC, v_bufferTemp_degC, dt_h);
	t_incentiveMode.setColor(gray);
	t_incentiveMode.setText("off");
	//traceln("no heating");
	t_heatingMode.setColor(gray);
	t_heatingMode.setText("no heating");
}	

//traceln("primary + secondary "+roundToDecimal(v_primaryHeatProduction_kW+v_secondaryHeatProduction_kW,0)+", heat delivered: "+ roundToDecimal(heatingSystem.v_heatDelivery_kW,0));
f_socUpdate(v_heatDeliveryToNetwork_kW, v_heatingNetworkDemand, dt_h); // 	]]></Body>
				</Function>
				<Function AccessType="public" StaticFunction="false">
					<ReturnModificator>VOID</ReturnModificator>
					<ReturnType><![CDATA[double]]></ReturnType>
					<Id>1650636861587</Id>
					<Name><![CDATA[f_CalculateHeatProduction]]></Name>
					<Description><![CDATA[@author Peter Hogeveen
@since 14-04-2022]]></Description>
					<X>480</X><Y>300</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Parameter>
						<Name><![CDATA[heatRequestPrimary_kW]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[heatRequestSecondary_kW]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[heatRequestBackup_kW]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[baseTemperatureHeat]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[destinationTemperatureHeat]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Parameter>
						<Name><![CDATA[timeStep_HR]]></Name>
						<Type><![CDATA[double]]></Type>
					</Parameter>
					<Body><![CDATA[//Reset waarden voor tijdstap
heatingSystem.v_heatDelivery_kW = 0;
heatingSystem.v_GasConsumption_m3ph = 0;
heatingSystem.v_ElectricityConsumption_kW = 0;
v_primaryHeatProduction_kW = 0;
v_secondaryHeatProduction_kW = 0;
v_backupHeatProduction_kW = 0;

//Initialiseer lokale variabelen
J_GasHeater gasheater;
J_Heatpump heatpump;
J_Boiler boiler;
//J_DistrictHeatingCon districtHeatingCon;
//double COPheat;
//double etaHeatpump_f = etafactor;   // heatpump efficiency factor for calculating COP with temperature deltas
double heatDemandByPrimary_kW = 0;
double heatDemandBySecondary_kW = 0;
double heatDemandByBackup_kW = 0;
double heatproduction;

switch (p_heatingType) {
	case HeatPump_GasPeak_Boiler:
		heatpump = (J_Heatpump)heatingSystem.p_MyPrimaryHeatingSystem;
		gasheater = (J_GasHeater)heatingSystem.p_MySecondaryHeatingSystem;
		boiler = (J_Boiler)heatingSystem.p_MyBackupHeatingSystem;

		// Primary (heatpump)	
		heatproduction = heatpump.produceHeat( heatRequestPrimary_kW, baseTemperatureHeat, destinationTemperatureHeat, true );
		heatingSystem.v_ElectricityConsumption_kW += heatpump.getElectricityConsumption();
		v_primaryHeatProduction_kW += heatproduction;
		heatingSystem.v_heatDelivery_kW += heatproduction;
		//traceln("heatproduction! 1: "+heatproduction + "|| heatdelivery: "+heatingSystem.v_heatDelivery_kW);
		v_heatPumpPowerDraw_kW = heatpump.getElectricityConsumption();
		
		//Secondary (Gas heater)
		heatproduction = gasheater.produceHeat( heatRequestSecondary_kW, true );
		v_secondaryHeatProduction_kW += heatproduction;
		heatingSystem.v_heatDelivery_kW += heatproduction;
		//traceln("heatproduction! 2: "+heatproduction + "|| heatdelivery: "+heatingSystem.v_heatDelivery_kW);
		heatingSystem.v_GasConsumption_m3ph = gasheater.getGasConsumption();
		
		//Backup (E-Boiler)
		heatproduction = boiler.produceHotWater( heatRequestBackup_kW );
		heatingSystem.v_ElectricityConsumption_kW += boiler.getElectricityConsumption();
		heatingSystem.v_heatDelivery_kW += heatproduction;
		v_backupHeatProduction_kW += heatproduction;
		//traceln("heatproduction! 1: "+heatproduction + "|| heatdelivery: "+heatingSystem.v_heatDelivery_kW);
		v_heatPumpPowerDraw_kW += boiler.getElectricityConsumption();
		
	break;	
			
	default:
		error("no correct heating system in place");
}

v_heatDeliveryToNetwork_kW = v_primaryHeatProduction_kW + v_secondaryHeatProduction_kW + v_backupHeatProduction_kW;

//Bereken totalen van deze tijdstap
heatingSystem.v_HeatDelivered_kWh += heatingSystem.v_heatDelivery_kW * timeStep_HR ;
//v_hotWaterDelivered_kWh += v_hotWaterDelivery_kW * timeStep_HR ;
heatingSystem.v_CumGasConsumed_m3 += heatingSystem.v_GasConsumption_m3ph * timeStep_HR;
heatingSystem.v_CumElectricityConsumed_kWh += heatingSystem.v_ElectricityConsumption_kW * timeStep_HR;
//v_DistrictHeatingAbsorped_kWh += v_DistrictHeatingAbsorption_kW * timeStep_HR;

]]></Body>
				</Function>
			</Functions>
			<TableFunctions>
				<TableFunction AccessType="public" StaticFunction="false">
					<Id>1650880394161</Id>
					<Name><![CDATA[tb_electricityPriceToCOPThreshold]]></Name>
					<X>480</X><Y>40</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<InterpolationMethod>LINEAR</InterpolationMethod>
					<OutOfRangeBehaviour>EXTRAPOLATE</OutOfRangeBehaviour>
					<OutOfRangeCustomValue><![CDATA[0.0]]></OutOfRangeCustomValue>
					<ApproximationOrder><![CDATA[1]]></ApproximationOrder>
					<LoadFromDatabase><![CDATA[false]]></LoadFromDatabase>
					<ValuesQuery>
						<TableReference>
						</TableReference>
							<ArgumentColumnReference>
							</ArgumentColumnReference>
							<ValueColumnReference>
							</ValueColumnReference>
					</ValuesQuery>
// arguments and values
					<Argument><![CDATA[0.0]]></Argument>
					<Argument><![CDATA[0.1]]></Argument>
					<Argument><![CDATA[0.3]]></Argument>
					<Value><![CDATA[0.0]]></Value>
					<Value><![CDATA[1.5]]></Value>
					<Value><![CDATA[2.5]]></Value>
				</TableFunction>
			</TableFunctions>
			<AgentLinks>
				<AgentLink>
					<Id>1650616556444</Id>
					<Name><![CDATA[connections]]></Name>
					<X>50</X><Y>-20</Y>
					<Label><X>15</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<HandleReceiveInConnections>false</HandleReceiveInConnections>
					<AgentLinkType>COLLECTION_OF_LINKS</AgentLinkType>
					<AgentLinkBidirectional>true</AgentLinkBidirectional>
					<MessageType><![CDATA[Object]]></MessageType>
					<LineStyle>SOLID</LineStyle>
					<LineWidth>1</LineWidth>
					<LineColor>-16777216</LineColor>
					<LineZOrder>UNDER_AGENTS</LineZOrder>
					<LineArrow>NONE</LineArrow>
					<LineArrowPosition>END</LineArrowPosition>
				</AgentLink>
				<AgentLink>
					<Id>1650616556446</Id>
					<Name><![CDATA[conn_contractedConsumers]]></Name>
					<X>170</X><Y>-50</Y>
					<Label><X>15</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<HandleReceiveInConnections>false</HandleReceiveInConnections>
					<AgentLinkType>COLLECTION_OF_LINKS</AgentLinkType>
					<AgentLinkBidirectional>false</AgentLinkBidirectional>
					<MessageType><![CDATA[Object]]></MessageType>
					<LineStyle>SOLID</LineStyle>
					<LineWidth>1</LineWidth>
					<LineColor>-16777216</LineColor>
					<LineZOrder>UNDER_AGENTS</LineZOrder>
					<LineArrow>NONE</LineArrow>
					<LineArrowPosition>END</LineArrowPosition>
				</AgentLink>
			</AgentLinks>

			<EmbeddedObjects>
				<EmbeddedObject>
					<Id>1650876368323</Id>
					<Name><![CDATA[heatingSystem]]></Name>
					<X>720</X><Y>220</Y>
					<Label><X>20</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<ActiveObjectClass>
						<PackageName><![CDATA[heatingsystems]]></PackageName>
						<ClassName><![CDATA[HeatingSystem]]></ClassName>
					</ActiveObjectClass>
					<GenericParameterSubstitute>
						<GenericParameterSubstituteReference>
							<PackageName><![CDATA[heatingsystems]]></PackageName>
							<ClassName><![CDATA[HeatingSystem]]></ClassName>
							<ItemName><![CDATA[1648027127020]]></ItemName>
						</GenericParameterSubstituteReference>
					</GenericParameterSubstitute>
					<Parameters>
						<Parameter>
							<Name><![CDATA[p_HeatingType]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyPrimaryHeatingSystem]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MySecondaryHeatingSystem]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_hybridCOPThreshold]]></Name>
						</Parameter>
						<Parameter>
							<Name><![CDATA[p_MyBackupHeatingSystem]]></Name>
						</Parameter>
					</Parameters>
					<ReplicationFlag>false</ReplicationFlag>
					<Replication Class="CodeValue">
						<Code><![CDATA[100]]></Code>
					</Replication>
					<CollectionType>ARRAY_LIST_BASED</CollectionType>
					<InEnvironment>true</InEnvironment>	
					<InitialLocationType>AT_ANIMATION_POSITION</InitialLocationType>
					<XCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</XCode>
					<YCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</YCode>
					<ZCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ZCode>
					<ColumnCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</ColumnCode>
					<RowCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</RowCode>
					<LatitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LatitudeCode>
					<LongitudeCode Class="CodeValue">
						<Code><![CDATA[0]]></Code>
					</LongitudeCode>
					<LocationNameCode Class="CodeValue">
						<Code><![CDATA[""]]></Code>
					</LocationNameCode>
					<InitializationType>SPECIFIED_NUMBER</InitializationType>
					<InitializationDatabaseTableQuery>
						<TableReference>
						</TableReference>
					</InitializationDatabaseTableQuery>
					<InitializationDatabaseType>ONE_AGENT_PER_DATABASE_RECORD</InitializationDatabaseType>
					<QuantityColumn>
					</QuantityColumn>
				</EmbeddedObject>
			</EmbeddedObjects>

			<Presentation>
				<Level>
					<Id>1650616556390</Id>
					<Name><![CDATA[level]]></Name>
					<X>0</X><Y>0</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<Z>0</Z>
					<LevelVisibility>DIM_NON_CURRENT</LevelVisibility>

			<Presentation>
				<Text>
					<Id>1650616556394</Id>
					<Name><![CDATA[text2]]></Name>
					<X>20</X><Y>0</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[Buffer characteristics]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>14</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
    			<TimePlot>
					<Id>1650616556400</Id>
					<Name><![CDATA[pl_avgSoC]]></Name>
					<X>-10</X><Y>340</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<AutoUpdate>true</AutoUpdate>
					<OccurrenceAtTime>true</OccurrenceAtTime>
					<OccurrenceDate>1644307200000</OccurrenceDate>
					<OccurrenceTime Class="CodeUnitValue">
						<Code><![CDATA[0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</OccurrenceTime>
					<RecurrenceCode Class="CodeUnitValue">
						<Code><![CDATA[1]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</RecurrenceCode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Width>410</Width>
					<Height>250</Height>
					<BackgroundColor/>
					<BorderColor/>
					<ChartArea>
						<XOffset>50</XOffset>
						<YOffset>30</YOffset>
						<Width>330</Width>
						<Height>160</Height>
						<BackgroundColor>-1</BackgroundColor>
						<BorderColor>-16777216</BorderColor>
						<GridColor>-12566464</GridColor>
					</ChartArea>
					<Legend>
						<Place>SOUTH</Place>
						<TextColor>-16777216</TextColor>
						<Size>30</Size>
					</Legend>
					<Labels>
						<HorLabelsPosition>DEFAULT</HorLabelsPosition>
						<VerLabelsPosition>DEFAULT</VerLabelsPosition>
						<TextColor>-12566464</TextColor>
					</Labels>
					<ShowLegend>true</ShowLegend>
					<TimeWindowsMovementType>MOVEMENT_WITH_DATA</TimeWindowsMovementType>		
					<TimeWindowUnits>MODEL_TIME_UNIT</TimeWindowUnits>
					<VerScaleFromExpression><![CDATA[40			]]></VerScaleFromExpression>
					<VerScaleToExpression><![CDATA[100]]></VerScaleToExpression>
					<VerScaleType>FIXED</VerScaleType>
					<DrawLine>true</DrawLine>
					<Interpolation>LINEAR</Interpolation>
					<DatasetExpression>  
						<Title><![CDATA[Temperatuur warmteopslag]]></Title>
					<Id>1650616556397</Id>
					<Expression><![CDATA[my_dataset]]></Expression>
					<Color>-60269</Color>
					<Expression2><![CDATA[v_bufferTemp_degC]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>NONE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<SamplesToKeep>8760</SamplesToKeep>
					<TimeWindowExpression><![CDATA[8760]]></TimeWindowExpression>
					<FillAreaUnderLine>false</FillAreaUnderLine>
					<LabelFormat>HH_mm</LabelFormat>
    			</TimePlot>
				<Text>
					<Id>1650637335931</Id>
					<Name><![CDATA[t_COPHeat]]></Name>
					<X>450</X><Y>440</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[COP Heatpump]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>10</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
				<Text>
					<Id>1650890427697</Id>
					<Name><![CDATA[t_heatingMode]]></Name>
					<X>760</X><Y>280</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[heating mode indicator]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>14</Size>
						<Style>0</Style>
					</Font>
					<Alignment>CENTER</Alignment>
				</Text>
				<Text>
					<Id>1650891063697</Id>
					<Name><![CDATA[t_incentiveMode]]></Name>
					<X>750</X><Y>260</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[incentive]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>14</Size>
						<Style>0</Style>
					</Font>
					<Alignment>CENTER</Alignment>
				</Text>
			</Presentation>

				</Level>
			</Presentation>

		</ActiveObjectClass>
		<!--   =========   Active Object Class   ========  -->
		<ActiveObjectClass>
			<Id>1650616566418</Id>
			<Name><![CDATA[DistrictHeatingNetwork]]></Name>
			<ClientAreaTopLeft><X>0</X><Y>0</Y></ClientAreaTopLeft>
			<Generic>false</Generic>
			<GenericParameter>
				<Id>1650616566413</Id>
				<Name><![CDATA[1650616566413]]></Name>
				<GenericParameterValue Class="CodeValue">
					<Code><![CDATA[T extends Agent]]></Code>
				</GenericParameterValue>
				<GenericParameterLabel><![CDATA[Generic parameter:]]></GenericParameterLabel>
			</GenericParameter>
			<FlowChartsUsage>ENTITY</FlowChartsUsage>
			<SamplesToKeep>100</SamplesToKeep>
			<LimitNumberOfArrayElements>false</LimitNumberOfArrayElements>
			<ElementsLimitValue>100</ElementsLimitValue>
			<MakeDefaultViewArea>true</MakeDefaultViewArea>
			<SceneGridColor/>
			<SceneBackgroundColor/>
			<SceneSkybox>null</SceneSkybox>
			<AgentProperties>
	 			<SpaceType>CONTINUOUS</SpaceType>			
				<EnvironmentDefinesInitialLocation>true</EnvironmentDefinesInitialLocation>
				<RotateAnimationTowardsMovement>true</RotateAnimationTowardsMovement>
				<RotateAnimationVertically>false</RotateAnimationVertically>
				<VelocityCode Class="CodeUnitValue">
					<Code><![CDATA[10]]></Code>
					<Unit Class="SpeedUnits"><![CDATA[MPS]]></Unit>
				</VelocityCode>
				<PhysicalLength Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalLength>
				<PhysicalWidth Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalWidth>
				<PhysicalHeight Class="CodeUnitValue">
					<Code><![CDATA[1]]></Code>
					<Unit Class="LengthUnits"><![CDATA[METER]]></Unit>
				</PhysicalHeight>
			</AgentProperties>
			<EnvironmentProperties>
					<EnableSteps>false</EnableSteps>
					<StepDurationCode Class="CodeUnitValue">
						<Code><![CDATA[1.0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[SECOND]]></Unit>
					</StepDurationCode>
					<SpaceType>CONTINUOUS</SpaceType>
					<WidthCode><![CDATA[500]]></WidthCode>
					<HeightCode><![CDATA[500]]></HeightCode>
					<ZHeightCode><![CDATA[0]]></ZHeightCode>
					<ColumnsCountCode><![CDATA[100]]></ColumnsCountCode>
					<RowsCountCode><![CDATA[100]]></RowsCountCode>
					<NeigborhoodType>MOORE</NeigborhoodType>
					<LayoutType>USER_DEF</LayoutType>
					<LayoutTypeApplyOnStartup>true</LayoutTypeApplyOnStartup>
					<NetworkType>USER_DEF</NetworkType>
					<NetworkTypeApplyOnStartup>true</NetworkTypeApplyOnStartup>
					<ConnectionsPerAgentCode><![CDATA[2]]></ConnectionsPerAgentCode>
					<ConnectionsRangeCode><![CDATA[50]]></ConnectionsRangeCode>
					<NeighborLinkFractionCode><![CDATA[0.95]]></NeighborLinkFractionCode>
					<MCode><![CDATA[10]]></MCode>
			</EnvironmentProperties>
			<DatasetsCreationProperties>
				<AutoCreate>true</AutoCreate>
					<OccurrenceAtTime>true</OccurrenceAtTime>
					<OccurrenceDate>1650096000000</OccurrenceDate>
					<OccurrenceTime Class="CodeUnitValue">
						<Code><![CDATA[0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</OccurrenceTime>
					<RecurrenceCode Class="CodeUnitValue">
						<Code><![CDATA[1]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</RecurrenceCode>
			</DatasetsCreationProperties>
			<ScaleRuler>
				<Id>1650616566414</Id>
				<Name><![CDATA[scale]]></Name>
				<X>0</X><Y>-150</Y>
				<PublicFlag>false</PublicFlag>
				<PresentationFlag>false</PresentationFlag>
				<ShowLabel>false</ShowLabel>
				<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
				<Length>100</Length>
				<Rotation>0</Rotation>
				<ScaleType>BASED_ON_LENGTH</ScaleType>
				<ModelLength>10</ModelLength>
				<LengthUnits>METER</LengthUnits>
				<Scale>10</Scale>
				<InheritedFromParentAgentType>true</InheritedFromParentAgentType>
			</ScaleRuler>
			<CurrentLevel>1650616566436</CurrentLevel>
			<ConnectionsId>1650616566486</ConnectionsId>
			<Variables>
				<Variable Class="PlainVariable">
					<Id>1650616566424</Id>
					<Name><![CDATA[v_numberOfConsumers]]></Name>
					<Description><![CDATA[Number of connected consumers.

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>50</X><Y>140</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[int]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616566426</Id>
					<Name><![CDATA[v_consumerHeatDemand_kW]]></Name>
					<Description><![CDATA[Current heat demand of connected consumers. 
Value is not a known quantity (to heat producers), but is used in f_UpdateNetworkHeatBalance() to calculate network energy balance.

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>50</X><Y>190</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616566428</Id>
					<Name><![CDATA[v_networkHeatDemand_kW]]></Name>
					<Description><![CDATA[Total heat supplied to the network by connected suppliers for use in the network energy balance.

Updated in: f_UpdateNetworkHeatBalance().

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>50</X><Y>280</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616566430</Id>
					<Name><![CDATA[v_heatLoss_kW]]></Name>
					<Description><![CDATA[Current heat loss of the supply side of the network in kW.

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>50</X><Y>230</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616566432</Id>
					<Name><![CDATA[v_networkSupplyTemp_degC]]></Name>
					<Description><![CDATA[Current operating temperature of the supply flow.

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>340</X><Y>190</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[p_maxOperatingTemp_degC]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650616566434</Id>
					<Name><![CDATA[v_networkReturnTemp_degC]]></Name>
					<Description><![CDATA[Current operating temperature of the return flow.
Used to calculate volume flows and power later (TODO: implement this)

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>340</X><Y>210</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[double]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[20]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="PlainVariable">
					<Id>1650620419751</Id>
					<Name><![CDATA[v_numberOfSuppliers]]></Name>
					<X>50</X><Y>160</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" Constant="false" AccessType="public" StaticVariable="false">
						<Type><![CDATA[int]]></Type>        
						<InitialValue Class="CodeValue">
							<Code><![CDATA[0]]></Code>
						</InitialValue>
					</Properties>
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616566457</Id>
					<Name><![CDATA[v_networkWaterFlow_m3ph]]></Name>
					<Description><![CDATA[Heat network water flow. To be used for calculating temperatures along the network topography later

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>50</X><Y>340</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[30]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616566455</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616566460</Id>
					<Name><![CDATA[p_networkHeatloss_Wpm2K]]></Name>
					<Description><![CDATA[Estimated value for heat loss in W/m2K, @ high quality pipes and inner pipe diameter = ca. 0.2 m.

Derived from: https://doi.org/10.1016/j.egypro.2016.09.069]]></Description>
					<X>70</X><Y>110</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[0.03]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616566458</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616566463</Id>
					<Name><![CDATA[p_soilTemp_degC]]></Name>
					<Description><![CDATA[Average underground temperature, used for calculating distribution heat losses.

TODO: make this a universal value together with HeatingSystems PTES_w_Heatpump

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>70</X><Y>90</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[10]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616566461</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616566466</Id>
					<Name><![CDATA[p_networkDiameter_m]]></Name>
					<Description><![CDATA[Average pipe diameter of the complete network. Placeholder value.
Reference: https://doi.org/10.1016/j.egypro.2016.09.069

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>50</X><Y>60</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[0.2]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616566464</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616566469</Id>
					<Name><![CDATA[cpWater_kJpkgK]]></Name>
					<Description><![CDATA[J/(kg K)]]></Description>
					<X>300</X><Y>60</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[4.184]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616566467</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616566472</Id>
					<Name><![CDATA[p_networkLength_m]]></Name>
					<Description><![CDATA[Network length in meters, based on 40 houses. Assumption: double pipe system with 800m supply, 800m return.

Uses:
-calculation of network heat losses over the network length
-calculation of network pumping energy (electric)  // TODO!

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>50</X><Y>40</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[400]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616566470</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616566481</Id>
					<Name><![CDATA[p_minOperatingTemp_degC]]></Name>
					<Description><![CDATA[Minimum operating temperature of the (MT) district heat network]]></Description>
					<X>330</X><Y>140</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[50]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616566479</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
				<Variable Class="Parameter">
					<Id>1650616566484</Id>
					<Name><![CDATA[p_maxOperatingTemp_degC]]></Name>
					<Description><![CDATA[Maximum operating temperature of the (MT) district heat network]]></Description>
					<X>330</X><Y>160</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Properties SaveInSnapshot="true" ModificatorType="STATIC">
						<Type><![CDATA[double]]></Type>
						<UnitType><![CDATA[NONE]]></UnitType>
						<SdArray>false</SdArray>
						<DefaultValue Class="CodeValue">
							<Code><![CDATA[65]]></Code>
						</DefaultValue>
						<ParameterEditor>
							<Id>1650616566482</Id>
							<EditorContolType>TEXT_BOX</EditorContolType>
							<MinSliderValue><![CDATA[0]]></MinSliderValue>
							<MaxSliderValue><![CDATA[100]]></MaxSliderValue>
							<DelimeterType>NO_DELIMETER</DelimeterType>
						</ParameterEditor>
					</Properties>                 
				</Variable>
			</Variables>
			<Functions>
				<Function AccessType="public" StaticFunction="false">
					<ReturnModificator>VOID</ReturnModificator>
					<ReturnType><![CDATA[double]]></ReturnType>
					<Id>1650616566420</Id>
					<Name><![CDATA[f_UpdateNetworkHeatBalance]]></Name>
					<Description><![CDATA[Used to calculate energy flows into and out of the district heat network, and with that the current network operating temperature.
-Inflows: heat supplier(s),
-Outflows: heat consumption by consumers, heat losses from the network.

1) Consumers and suppliers are connected by agent links. 
2) Total heat demand and supply are determined
3) Network temperature is determined assuming a single, perfectly mixed vessel (for now)

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>50</X><Y>310</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<Body><![CDATA[/* v_numberOfConsumers = 0;
for ( Huishouden h : main.huishoudens ) {
	if ( h.heatingSystem.p_HeatingType.equals(OL_HeatingTypes.DistrictHeating) || h.heatingSystem.p_HeatingType.equals(OL_HeatingTypes.DistrictHeating_w_Boiler ) ) {
		// traceln("connect! ");
		this.conn_heatConsumers.connectTo(h.heatingSystem);
		h.heatingSystem.connectTo(this);
		v_numberOfConsumers ++;
	}
} */

// retrieve the current heat demand from the network
v_consumerHeatDemand_kW = 0;
for (int i = 0; i < this.conn_heatConsumers.getConnections().size(); i++) {
	Agent j = this.conn_heatConsumers.getConnectedAgent(i);
	if ( j instanceof HeatingSystem ){
		HeatingSystem h = (HeatingSystem)this.conn_heatConsumers.getConnectedAgent(i);
		//traceln("heat drawn from net "+h.v_DistrictHeatingAbsorption_kW);
		v_consumerHeatDemand_kW += h.v_DistrictHeatingAbsorption_kW;
	}
}

// retrieve the current heat influx in the network from producers -> Not needed, simply use inflow temp as either fixed (and equal to minimum buffertemp) or equal to buffertemp.
/*v_producerHeatSupply_kW = 0;
for (int j = 0; j < this.conn_heatSuppliers.getConnections().size(); j++) {
	DH_PTESWithHeatpump p = (DH_PTESWithHeatpump)this.conn_heatSuppliers.getConnectedAgent(j);
		v_producerHeatSupply_kW += p.v_heatDelivery_kW;
	}*/

// update network energy balance
v_heatLoss_kW = ( p_networkHeatloss_Wpm2K * 3.1415 * p_networkDiameter_m * p_networkLength_m * ( (v_networkSupplyTemp_degC + v_networkReturnTemp_degC)/2 - p_soilTemp_degC ) ) / 1000;
//v_heatLossReturn_kW = ( p_networkHeatloss_WpK_m * p_networkLength_m * ( v_networkReturnTemp_degC - p_soilTemp_degC ) ) / 1000;

//double dQdt_kW;
v_networkHeatDemand_kW = v_heatLoss_kW + v_consumerHeatDemand_kW;

// update network temperature
// v_networkSupplyTemp_degC += dQdt_kW * main.dt_h / p_networkSpecificHeat_kWhpK;

//v_networkSupplyTemp_degC += dQdt_kW * main.dt_h / ((4.2*1000)*v_networkWaterFlow_m3ph/3600);
//traceln("agent "+this.conn_heatSuppliers.getConnectedAgent(0));
Agent d = this.conn_heatSuppliers.getConnectedAgent(0);
if ( d instanceof DH_PTESWithHeatPump ) {
	v_networkSupplyTemp_degC = ((DH_PTESWithHeatPump) d).v_bufferTemp_degC;
	v_networkReturnTemp_degC = v_networkSupplyTemp_degC - v_networkHeatDemand_kW / (cpWater_kJpkgK * 1000 * v_networkWaterFlow_m3ph/3600 ); // 
}
]]></Body>
				</Function>
			</Functions>
			<AgentLinks>
				<AgentLink>
					<Id>1650616566486</Id>
					<Name><![CDATA[connections]]></Name>
					<X>170</X><Y>-90</Y>
					<Label><X>15</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<HandleReceiveInConnections>false</HandleReceiveInConnections>
					<AgentLinkType>COLLECTION_OF_LINKS</AgentLinkType>
					<AgentLinkBidirectional>true</AgentLinkBidirectional>
					<MessageType><![CDATA[Object]]></MessageType>
					<LineStyle>SOLID</LineStyle>
					<LineWidth>1</LineWidth>
					<LineColor>-16777216</LineColor>
					<LineZOrder>UNDER_AGENTS</LineZOrder>
					<LineArrow>NONE</LineArrow>
					<LineArrowPosition>END</LineArrowPosition>
				</AgentLink>
				<AgentLink>
					<Id>1650616566488</Id>
					<Name><![CDATA[conn_heatConsumers]]></Name>
					<Description><![CDATA[District heating consumers currently connected to the network.
Connections managed in f_UpdateNetworkHeatBalance().

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>170</X><Y>-60</Y>
					<Label><X>15</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<HandleReceiveInConnections>false</HandleReceiveInConnections>
					<AgentLinkType>COLLECTION_OF_LINKS</AgentLinkType>
					<AgentLinkBidirectional>false</AgentLinkBidirectional>
					<MessageType><![CDATA[Object]]></MessageType>
					<LineStyle>SOLID</LineStyle>
					<LineWidth>1</LineWidth>
					<LineColor>-16777216</LineColor>
					<LineZOrder>UNDER_AGENTS</LineZOrder>
					<LineArrow>NONE</LineArrow>
					<LineArrowPosition>END</LineArrowPosition>
				</AgentLink>
				<AgentLink>
					<Id>1650616566490</Id>
					<Name><![CDATA[conn_heatSuppliers]]></Name>
					<Description><![CDATA[District heating suppliers currently connected to the network.
Connections managed in f_UpdateNetworkHeatBalance().

@author: JorritvandenHouten
@since: 15/04/2022]]></Description>
					<X>170</X><Y>-30</Y>
					<Label><X>15</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>true</ShowLabel>
					<HandleReceiveInConnections>false</HandleReceiveInConnections>
					<AgentLinkType>COLLECTION_OF_LINKS</AgentLinkType>
					<AgentLinkBidirectional>false</AgentLinkBidirectional>
					<MessageType><![CDATA[Object]]></MessageType>
					<LineStyle>SOLID</LineStyle>
					<LineWidth>1</LineWidth>
					<LineColor>-16777216</LineColor>
					<LineZOrder>UNDER_AGENTS</LineZOrder>
					<LineArrow>NONE</LineArrow>
					<LineArrowPosition>END</LineArrowPosition>
				</AgentLink>
			</AgentLinks>


			<Presentation>
				<Level>
					<Id>1650616566436</Id>
					<Name><![CDATA[level]]></Name>
					<X>0</X><Y>0</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<Z>0</Z>
					<LevelVisibility>DIM_NON_CURRENT</LevelVisibility>

			<Presentation>
				<Group>
					<Id>1650616566438</Id>
					<Name><![CDATA[cloud]]></Name>
					<X>0</X><Y>0</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>

			<Presentation>
				<Curve ControlPoints="true">
					<Id>1650616566440</Id>
					<Name><![CDATA[_ps300]]></Name>
					<X>-40</X><Y>-31</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<ZHeight>10</ZHeight>
					<LineWidth>1</LineWidth>
					<LineColor>-11702146</LineColor>
					<LineMaterial>null</LineMaterial>
					<LineStyle>SOLID</LineStyle>
					<BeginArrowSize>1</BeginArrowSize>
					<BeginArrowStyle>0</BeginArrowStyle>
					<EndArrowSize>1</EndArrowSize>
					<EndArrowStyle>0</EndArrowStyle>
					<FillColor>-5383962</FillColor>
					<FillMaterial>null</FillMaterial>
					<Points>
					   <Point><X>0</X><Y>0</Y><Z>0</Z></Point>
					   <Point><X>11</X><Y>-10</Y><Z>0</Z></Point>
					   <Point><X>23</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>23</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>23</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>26</X><Y>-12</Y><Z>0</Z></Point>
					   <Point><X>45</X><Y>-12</Y><Z>0</Z></Point>
					   <Point><X>64</X><Y>-12</Y><Z>0</Z></Point>
					   <Point><X>68</X><Y>6</Y><Z>0</Z></Point>
					   <Point><X>68</X><Y>6</Y><Z>0</Z></Point>
					   <Point><X>68</X><Y>6</Y><Z>0</Z></Point>
					   <Point><X>82</X><Y>-2</Y><Z>0</Z></Point>
					   <Point><X>89</X><Y>12</Y><Z>0</Z></Point>
					   <Point><X>97</X><Y>26</Y><Z>0</Z></Point>
					   <Point><X>83</X><Y>32</Y><Z>0</Z></Point>
					   <Point><X>83</X><Y>32</Y><Z>0</Z></Point>
					   <Point><X>83</X><Y>32</Y><Z>0</Z></Point>
					   <Point><X>93</X><Y>42</Y><Z>0</Z></Point>
					   <Point><X>85</X><Y>53</Y><Z>0</Z></Point>
					   <Point><X>76</X><Y>64</Y><Z>0</Z></Point>
					   <Point><X>59</X><Y>56</Y><Z>0</Z></Point>
					   <Point><X>59</X><Y>56</Y><Z>0</Z></Point>
					   <Point><X>59</X><Y>56</Y><Z>0</Z></Point>
					   <Point><X>54</X><Y>70</Y><Z>0</Z></Point>
					   <Point><X>37</X><Y>70</Y><Z>0</Z></Point>
					   <Point><X>21</X><Y>70</Y><Z>0</Z></Point>
					   <Point><X>17</X><Y>55</Y><Z>0</Z></Point>
					   <Point><X>17</X><Y>55</Y><Z>0</Z></Point>
					   <Point><X>17</X><Y>55</Y><Z>0</Z></Point>
					   <Point><X>7</X><Y>61</Y><Z>0</Z></Point>
					   <Point><X>-3</X><Y>51</Y><Z>0</Z></Point>
					   <Point><X>-15</X><Y>35</Y><Z>0</Z></Point>
					   <Point><X>0</X><Y>23</Y><Z>0</Z></Point>
					   <Point><X>0</X><Y>23</Y><Z>0</Z></Point>
					   <Point><X>0</X><Y>23</Y><Z>0</Z></Point>
					   <Point><X>-11</X><Y>10</Y><Z>0</Z></Point>
					</Points>
					<Closed>true</Closed>
				</Curve>
				<Curve ControlPoints="true">
					<Id>1650616566442</Id>
					<Name><![CDATA[_ps301]]></Name>
					<X>-37</X><Y>-26</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<ZHeight>10</ZHeight>
					<LineWidth>1</LineWidth>
					<LineColor/>
					<LineMaterial>null</LineMaterial>
					<LineStyle>SOLID</LineStyle>
					<BeginArrowSize>1</BeginArrowSize>
					<BeginArrowStyle>0</BeginArrowStyle>
					<EndArrowSize>1</EndArrowSize>
					<EndArrowStyle>0</EndArrowStyle>
					<FillColor>-1</FillColor>
					<FillMaterial>null</FillMaterial>
					<Points>
					   <Point><X>0</X><Y>0</Y><Z>0</Z></Point>
					   <Point><X>9</X><Y>-10</Y><Z>0</Z></Point>
					   <Point><X>21</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>21</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>21</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>24</X><Y>-14</Y><Z>0</Z></Point>
					   <Point><X>42</X><Y>-14</Y><Z>0</Z></Point>
					   <Point><X>58</X><Y>-13</Y><Z>0</Z></Point>
					   <Point><X>60</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>60</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>60</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>58</X><Y>-11</Y><Z>0</Z></Point>
					   <Point><X>42</X><Y>-12</Y><Z>0</Z></Point>
					   <Point><X>27</X><Y>-13</Y><Z>0</Z></Point>
					   <Point><X>21</X><Y>5</Y><Z>0</Z></Point>
					   <Point><X>21</X><Y>5</Y><Z>0</Z></Point>
					   <Point><X>21</X><Y>5</Y><Z>0</Z></Point>
					   <Point><X>10</X><Y>-5</Y><Z>0</Z></Point>
					   <Point><X>2</X><Y>2</Y><Z>0</Z></Point>
					   <Point><X>-5</X><Y>8</Y><Z>0</Z></Point>
					   <Point><X>3</X><Y>19</Y><Z>0</Z></Point>
					   <Point><X>3</X><Y>19</Y><Z>0</Z></Point>
					   <Point><X>3</X><Y>19</Y><Z>0</Z></Point>
					   <Point><X>-8</X><Y>29</Y><Z>0</Z></Point>
					   <Point><X>-4</X><Y>42</Y><Z>0</Z></Point>
					   <Point><X>-11</X><Y>30</Y><Z>0</Z></Point>
					   <Point><X>1</X><Y>18</Y><Z>0</Z></Point>
					   <Point><X>1</X><Y>18</Y><Z>0</Z></Point>
					   <Point><X>1</X><Y>18</Y><Z>0</Z></Point>
					   <Point><X>-9</X><Y>10</Y><Z>0</Z></Point>
					</Points>
					<Closed>true</Closed>
				</Curve>
			</Presentation>

				</Group>
    			<TimePlot>
					<Id>1650616566449</Id>
					<Name><![CDATA[plot]]></Name>
					<X>270</X><Y>230</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<AutoUpdate>true</AutoUpdate>
					<OccurrenceAtTime>true</OccurrenceAtTime>
					<OccurrenceDate>1650096000000</OccurrenceDate>
					<OccurrenceTime Class="CodeUnitValue">
						<Code><![CDATA[0]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</OccurrenceTime>
					<RecurrenceCode Class="CodeUnitValue">
						<Code><![CDATA[1]]></Code>
						<Unit Class="TimeUnits"><![CDATA[HOUR]]></Unit>
					</RecurrenceCode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Width>260</Width>
					<Height>210</Height>
					<BackgroundColor/>
					<BorderColor/>
					<ChartArea>
						<XOffset>50</XOffset>
						<YOffset>30</YOffset>
						<Width>180</Width>
						<Height>120</Height>
						<BackgroundColor>-1</BackgroundColor>
						<BorderColor>-16777216</BorderColor>
						<GridColor>-12566464</GridColor>
					</ChartArea>
					<Legend>
						<Place>SOUTH</Place>
						<TextColor>-16777216</TextColor>
						<Size>30</Size>
					</Legend>
					<Labels>
						<HorLabelsPosition>DEFAULT</HorLabelsPosition>
						<VerLabelsPosition>DEFAULT</VerLabelsPosition>
						<TextColor>-12566464</TextColor>
					</Labels>
					<ShowLegend>true</ShowLegend>
					<TimeWindowsMovementType>MOVEMENT_WITH_TIME</TimeWindowsMovementType>		
					<TimeWindowUnits>MODEL_TIME_UNIT</TimeWindowUnits>
					<VerScaleFromExpression><![CDATA[0]]></VerScaleFromExpression>
					<VerScaleToExpression><![CDATA[1]]></VerScaleToExpression>
					<VerScaleType>AUTO</VerScaleType>
					<DrawLine>true</DrawLine>
					<Interpolation>LINEAR</Interpolation>
					<DatasetExpression>  
						<Title><![CDATA[network supply temp (degC)]]></Title>
					<Id>1650616566443</Id>
					<Expression><![CDATA[my_dataset]]></Expression>
					<Color>-7667573</Color>
					<Expression2><![CDATA[v_networkSupplyTemp_degC]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>NONE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<DatasetExpression>  
						<Title><![CDATA[min. temperature range]]></Title>
					<Id>1650616566444</Id>
					<Expression><![CDATA[my_dataset1]]></Expression>
					<Color>-16776961</Color>
					<Expression2><![CDATA[p_minOperatingTemp_degC]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>NONE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<DatasetExpression>  
						<Title><![CDATA[max. temperature range]]></Title>
					<Id>1650616566445</Id>
					<Expression><![CDATA[my_dataset2]]></Expression>
					<Color>-65536</Color>
					<Expression2><![CDATA[p_maxOperatingTemp_degC]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>NONE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<DatasetExpression>  
						<Title><![CDATA[network return temp (degC)]]></Title>
					<Id>1650616566446</Id>
					<Expression><![CDATA[my_dataset3]]></Expression>
					<Color>-23296</Color>
					<Expression2><![CDATA[v_networkReturnTemp_degC]]></Expression2>
					<Expression2Flag>true</Expression2Flag>
						<PointStyle>NONE</PointStyle>
						<LineWidth>1.0</LineWidth>
					</DatasetExpression>
					<SamplesToKeep>8760</SamplesToKeep>
					<TimeWindowExpression><![CDATA[8760]]></TimeWindowExpression>
					<FillAreaUnderLine>false</FillAreaUnderLine>
					<LabelFormat>MODEL_TIME_UNITS</LabelFormat>
    			</TimePlot>
				<Text>
					<Id>1650616566451</Id>
					<Name><![CDATA[text]]></Name>
					<X>50</X><Y>0</Y>
					<Label><X>0</X><Y>-10</Y></Label>
					<PublicFlag>false</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-16777216</Color>
					<Text><![CDATA[District Heating Network]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>18</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
			</Presentation>

				</Level>
			</Presentation>

		</ActiveObjectClass>
	</ActiveObjectClasses>	
	<DifferentialEquationsMethod>EULER</DifferentialEquationsMethod>
	<MixedEquationsMethod>RK45_NEWTON</MixedEquationsMethod>
	<AlgebraicEquationsMethod>MODIFIED_NEWTON</AlgebraicEquationsMethod>
	<AbsoluteAccuracy>1.0E-5</AbsoluteAccuracy>
	<FixedTimeStep>0.001</FixedTimeStep>
	<RelativeAccuracy>1.0E-5</RelativeAccuracy>
	<TimeAccuracy>1.0E-5</TimeAccuracy>
	<Frame>
		<Width>1000</Width>
		<Height>600</Height>
	</Frame>
	<Database>
		<Logging>false</Logging>
		<AutoExport>false</AutoExport>
		<ShutdownCompact>false</ShutdownCompact>
		<ImportSettings>
		</ImportSettings>
		<ExportSettings>
		</ExportSettings>
	</Database>
	
	<RunConfiguration ActiveObjectClassId="1648027099888">
		<Id>1648027099892</Id>
		<Name><![CDATA[RunConfiguration]]></Name>
		<MaximumMemory>512</MaximumMemory>
		<ModelTimeProperties>
			<StopOption><![CDATA[Stop at specified time]]></StopOption>
			<InitialDate><![CDATA[1647993600000]]></InitialDate>	
			<InitialTime><![CDATA[0.0]]></InitialTime>	
			<FinalDate><![CDATA[1650672000000]]></FinalDate>	
			<FinalTime><![CDATA[100.0]]></FinalTime>	
		</ModelTimeProperties>
		<AnimationProperties>
			<StopNever>true</StopNever>
			<ExecutionMode>realTimeScaled</ExecutionMode>
			<RealTimeScale>1.0</RealTimeScale>
			<EnableZoomAndPanning>true</EnableZoomAndPanning>
			<EnableDeveloperPanel>false</EnableDeveloperPanel>
			<ShowDeveloperPanelOnStart>false</ShowDeveloperPanelOnStart>
		</AnimationProperties>
		<Inputs>		
		</Inputs>
		<Outputs>
		</Outputs>
	</RunConfiguration>
	<Experiments>	
		<!--   =========   Simulation Experiment   ========  -->
		<SimulationExperiment ActiveObjectClassId="1648027099888">
			<Id>1649847285745</Id>
			<Name><![CDATA[HeatingSystemTest]]></Name>
			<ClientAreaTopLeft><X>0</X><Y>0</Y></ClientAreaTopLeft>
			<CommandLineArguments><![CDATA[]]></CommandLineArguments>
			<MaximumMemory>512</MaximumMemory>
			<RandomNumberGenerationType>fixedSeed</RandomNumberGenerationType>
			<CustomGeneratorCode>new Random()</CustomGeneratorCode>
			<SeedValue>1</SeedValue>
			<SelectionModeForSimultaneousEvents>LIFO</SelectionModeForSimultaneousEvents>
			<VmArgs><![CDATA[]]></VmArgs>
			<LoadRootFromSnapshot>false</LoadRootFromSnapshot>

			<Presentation>
				<Text>
					<Id>1649847285746</Id>
					<Name><![CDATA[text]]></Name>
					<X>50</X><Y>30</Y>
					<Label><X>10</X><Y>0</Y></Label>
					<PublicFlag>true</PublicFlag>
					<PresentationFlag>true</PresentationFlag>
					<ShowLabel>false</ShowLabel>
					<DrawMode>SHAPE_DRAW_2D3D</DrawMode>
					<EmbeddedIcon>false</EmbeddedIcon>
					<Z>0</Z>
					<Rotation>0.0</Rotation>
					<Color>-12490271</Color>
					<Text><![CDATA[HeatingSystems]]></Text>
					<Font>
						<Name>SansSerif</Name>
						<Size>24</Size>
						<Style>0</Style>
					</Font>
					<Alignment>LEFT</Alignment>
				</Text>
			</Presentation>

			<Parameters>			
				<Parameter>
					<ParameterName><![CDATA[p_esdlEnergySystem]]></ParameterName>
				</Parameter>
			</Parameters>			
			<PresentationProperties>
				<EnableZoomAndPanning>true</EnableZoomAndPanning>
				<ExecutionMode><![CDATA[realTimeScaled]]></ExecutionMode>
				<Title><![CDATA[HeatingSystems : Simulation]]></Title>	
				<EnableDeveloperPanel>true</EnableDeveloperPanel>
				<ShowDeveloperPanelOnStart>false</ShowDeveloperPanelOnStart>
				<RealTimeScale>1.0</RealTimeScale>
			</PresentationProperties>
			<ModelTimeProperties>
				<StopOption><![CDATA[Never]]></StopOption>
				<InitialDate><![CDATA[1649808000000]]></InitialDate>	
				<InitialTime><![CDATA[0.0]]></InitialTime>	
				<FinalDate><![CDATA[1652400000000]]></FinalDate>	
				<FinalTime><![CDATA[100.0]]></FinalTime>	
			</ModelTimeProperties>
			<BypassInitialScreen>true</BypassInitialScreen>
		</SimulationExperiment>	
	</Experiments>
	<JavaClasses>
		<!--   =========   Java Class   ========  -->
		<JavaClass>
			<Id>1649759055003</Id>
			<Name><![CDATA[J_DistrictHeatingCon]]></Name>
			<Text><![CDATA[/**
 * Author: Peter Hogeveen
 * Since: 14-04
 */	


public class J_DistrictHeatingCon implements Serializable {
	public HeatingSystem myHeatingSystem;
	public double maxPower_kW;
	public double currentPower_kW;
	public double hotWaterDelivery_kW;
	public double heatDelivery_kW;

    public J_DistrictHeatingCon( HeatingSystem HS, double power) {
    	maxPower_kW = power;
    	myHeatingSystem = HS;
    }

	@Override
	public String toString() {
		return super.toString();
	}

	public double deliverHotWater( double hotWaterRequest_kW, boolean waterFirst ){
		if ( waterFirst ) {
			currentPower_kW = 0;
			heatDelivery_kW = 0;
		}
		hotWaterDelivery_kW = min( hotWaterRequest_kW, maxPower_kW );
		currentPower_kW += hotWaterDelivery_kW;
		return hotWaterDelivery_kW ; 

	}
	
	public double deliverHeat( double heatRequest_kW, boolean heatFirst ){
		if ( heatFirst ) {
			currentPower_kW = 0;
			hotWaterDelivery_kW = 0;
		}
		heatDelivery_kW = min( heatRequest_kW, maxPower_kW - hotWaterDelivery_kW) ; 
		currentPower_kW += heatDelivery_kW;
		return heatDelivery_kW ; 
	}
	
	public double getAbsorption() {
		return currentPower_kW;
	}
	
	/**
	 * This number is here for model snapshot storing purpose<br>
	 * It needs to be changed when this class gets changed
	 */ 
	private static final long serialVersionUID = 1L;

}]]></Text>
		</JavaClass>
		<!--   =========   Java Class   ========  -->
		<JavaClass>
			<Id>1649759081324</Id>
			<Name><![CDATA[J_GasHeater]]></Name>
			<Text><![CDATA[/**
 * Author: Peter Hogeveen
 * Since: 13-04
 */	

import esdl.*;

public class J_GasHeater implements Serializable {

    HeatingSystem myHeatingSystem;
    DH_PTESWithHeatPump myDH_PTESWithHeatPump;
	double maxPower_kW;
	double efficiency;
	double hotWaterDelivery_kW;
	double heatDelivery_kW;
	double currentPower_kW;
	double gasConsumption_m3ph;
	double energyDensityGas_kWhPm3; //moeten constanten eigenlijk in de main staan?
    //GasHeater esdlObject;
 
    public J_GasHeater( HeatingSystem HS, double power ) {
    	myHeatingSystem = HS;
    	maxPower_kW = power;
    	energyDensityGas_kWhPm3 = 9.769;
    	efficiency = 0.95;
    	
    	//esdlObject = EsdlFactory.eINSTANCE.createGasHeater();
    	//esdlObject.setPower( maxPower );
    	//myHeatingSystem.main.p_esdlEnergySystem.getInstance().get(0).getArea().getAsset().add( esdlObject );
    }
    
    @Override
	public String toString() {
		return super.toString();
	}

	public double produceHotWater( double hotWaterRequest_kW, boolean waterFirst ) {
		if ( waterFirst ) {
			currentPower_kW = 0;
			heatDelivery_kW = 0;
		}
		hotWaterDelivery_kW = min( hotWaterRequest_kW, maxPower_kW - currentPower_kW );
		currentPower_kW += hotWaterDelivery_kW;
		return hotWaterDelivery_kW;
	}
	
	public double produceHeat( double heatRequest_kW, boolean heatFirst ){
		if ( heatFirst ) {
			currentPower_kW = 0;
			hotWaterDelivery_kW = 0;
		}
		heatDelivery_kW = min( heatRequest_kW, maxPower_kW - currentPower_kW ) ; // Hot water gets priority
		currentPower_kW += heatDelivery_kW;
		return heatDelivery_kW;
	}
	
	public double getGasConsumption() {
		gasConsumption_m3ph = currentPower_kW / efficiency / energyDensityGas_kWhPm3;
		return gasConsumption_m3ph;
	}

	
	
	/**
	 * This number is here for model snapshot storing purpose<br>
	 * It needs to be changed when this class gets changed
	 */ 
	private static final long serialVersionUID = 1L;

}]]></Text>
		</JavaClass>
		<!--   =========   Java Class   ========  -->
		<JavaClass>
			<Id>1649759094666</Id>
			<Name><![CDATA[J_Heatpump]]></Name>
			<Text><![CDATA[/**
 * Author: Peter Hogeveen
 * Since: 13-04
 */	

//import esdl.*;

public class J_Heatpump implements Serializable {

	public HeatingSystem myHeatingSystem;
	public DH_PTESWithHeatPump myDH_PTESWithHeatPump;
	public double maxPower_kW;
	public double etaHeatPump;
	public double currentPower_kW;
	public double hotWaterDelivery_kW;
	public double heatDelivery_kW;
	//public double baseTemperature;
	//public double destinationTemperature;
	public double COPwater;
	public double COPheat;
	
	
	//HeatPump esdlObject;
	
    public J_Heatpump(HeatingSystem HS, double power, double efficiency) {
    	maxPower_kW = power;
    	myHeatingSystem = HS;
    	etaHeatPump = efficiency;
//    	HS.t_COPHeat.setVisible(true);
//    	HS.t_COPWater.setVisible(true);
    	//esdlObject = EsdlFactory.eINSTANCE.createHeatPump(); 
    }
    
    @Override
	public String toString() {
		return super.toString();
	}

	//public void produceHotWater( double hotWaterRequest_kW, double COPwater, boolean waterFirst ){
	public double produceHotWater( double hotWaterRequest_kW, double baseTemperature, double destinationTemperature, boolean waterFirst ){
		double COPwater = etaHeatPump * ( 273.15 + destinationTemperature ) / (destinationTemperature - baseTemperature);
		
		if (waterFirst) {
			currentPower_kW = 0;
			heatDelivery_kW = 0;
		}
		hotWaterDelivery_kW = min( hotWaterRequest_kW, ( maxPower_kW - currentPower_kW ) * COPwater ) ;
		currentPower_kW += hotWaterDelivery_kW / COPwater;
		//myHeatingSystem.v_hotWaterDelivery_kW = hotWaterDelivery_kW;
		return hotWaterDelivery_kW;
	}
	
	//public void produceHeat( double heatRequest_kW, double COPheating, boolean heatFirst ){
	public double produceHeat( double heatRequest_kW, double baseTemperature, double destinationTemperature, boolean heatFirst ){
		double COPheating = etaHeatPump * ( 273.15 + destinationTemperature ) / (destinationTemperature - baseTemperature);
		
		if (heatFirst) {
			currentPower_kW = 0;
			hotWaterDelivery_kW = 0;
		}
		heatDelivery_kW = min( heatRequest_kW, (maxPower_kW - currentPower_kW ) * COPheating) ; // Hot water gets priority
		currentPower_kW += heatDelivery_kW / COPheating; 
		//myHeatingSystem.v_heatDelivery_kW = heatDelivery_kW;
		return heatDelivery_kW;
	}
	
	public double getElectricityConsumption() {
		return currentPower_kW;
	}
	
	public double getCOP(double baseTemperature, double destinationTemperature) {
		double COP = etaHeatPump * ( 273.15 + destinationTemperature ) / (destinationTemperature - baseTemperature);
		return COP;
	}
	/**
	 * This number is here for model snapshot storing purpose<br>
	 * It needs to be changed when this class gets changed
	 */ 
	private static final long serialVersionUID = 1L;

}]]></Text>
		</JavaClass>
		<!--   =========   Java Class   ========  -->
		<JavaClass>
			<Id>1649925921789</Id>
			<Name><![CDATA[J_Boiler]]></Name>
			<Text><![CDATA[/**
 * Author: Peter Hogeveen
 * Since: 13-04
 */	


public class J_Boiler implements Serializable {
	public HeatingSystem myHeatingSystem;
	public double maxPower_kW;
	public double currentPower_kW;
	public double hotwaterDelivery_kW;
	public double efficiency;


    public J_Boiler( HeatingSystem HS, double power) {
    	myHeatingSystem = HS;
    	maxPower_kW = power;
    	efficiency = 0.95;
    }

	public double produceHotWater( double hotWaterRequest_kW ){
		hotwaterDelivery_kW = min( hotWaterRequest_kW, maxPower_kW * efficiency );
		myHeatingSystem.v_hotWaterDelivery_kW = hotwaterDelivery_kW;
		currentPower_kW = hotwaterDelivery_kW / efficiency;
		return hotwaterDelivery_kW;
	}
	
	public double getElectricityConsumption() {
		return currentPower_kW;
	}
    
	@Override
	public String toString() {
		return super.toString();
	}

	/**
	 * This number is here for model snapshot storing purpose<br>
	 * It needs to be changed when this class gets changed
	 */ 
	private static final long serialVersionUID = 1L;

}]]></Text>
		</JavaClass>
	</JavaClasses>
	<ModelResources>
		<Resource>
			<Path><![CDATA[esdl-2.21.9.jar]]></Path>
			<ReferencedFromUserCode>false</ReferencedFromUserCode>
		</Resource>
		<Resource>
			<Path><![CDATA[org.eclipse.emf.common-2.24.0.jar]]></Path>
			<ReferencedFromUserCode>false</ReferencedFromUserCode>
		</Resource>
		<Resource>
			<Path><![CDATA[org.eclipse.emf.ecore.xmi-2.16.0.jar]]></Path>
			<ReferencedFromUserCode>false</ReferencedFromUserCode>
		</Resource>
		<Resource>
			<Path><![CDATA[org.eclipse.emf.ecore-2.25.0.jar]]></Path>
			<ReferencedFromUserCode>false</ReferencedFromUserCode>
		</Resource>
	</ModelResources>
    <RequiredLibraryReference>
		<LibraryName><![CDATA[com.anylogic.libraries.modules.markup_descriptors]]></LibraryName>
		<VersionMajor>1</VersionMajor>
		<VersionMinor>0</VersionMinor>
		<VersionBuild>0</VersionBuild>
    </RequiredLibraryReference>
	<ClassPathEntry>
		<ResourceReference>
			<PackageName><![CDATA[heatingsystems]]></PackageName>
			<ClassName><![CDATA[esdl-2.21.9.jar]]></ClassName>
		</ResourceReference>
		<Imported>true</Imported>
		<Folder>false</Folder>
	</ClassPathEntry>
	<ClassPathEntry>
		<ResourceReference>
			<PackageName><![CDATA[heatingsystems]]></PackageName>
			<ClassName><![CDATA[org.eclipse.emf.common-2.24.0.jar]]></ClassName>
		</ResourceReference>
		<Imported>true</Imported>
		<Folder>false</Folder>
	</ClassPathEntry>
	<ClassPathEntry>
		<ResourceReference>
			<PackageName><![CDATA[heatingsystems]]></PackageName>
			<ClassName><![CDATA[org.eclipse.emf.ecore.xmi-2.16.0.jar]]></ClassName>
		</ResourceReference>
		<Imported>true</Imported>
		<Folder>false</Folder>
	</ClassPathEntry>
	<ClassPathEntry>
		<ResourceReference>
			<PackageName><![CDATA[heatingsystems]]></PackageName>
			<ClassName><![CDATA[org.eclipse.emf.ecore-2.25.0.jar]]></ClassName>
		</ResourceReference>
		<Imported>true</Imported>
		<Folder>false</Folder>
	</ClassPathEntry>
</Model>
</AnyLogicWorkspace>